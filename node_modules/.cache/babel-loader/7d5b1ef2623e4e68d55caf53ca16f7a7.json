{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\n\nvar React = require('react');\n\nvar core = require('@react-pdf-viewer/core');\n\nfunction _interopNamespace(e) {\n  if (e && e.__esModule) return e;\n  var n = Object.create(null);\n\n  if (e) {\n    Object.keys(e).forEach(function (k) {\n      if (k !== 'default') {\n        var d = Object.getOwnPropertyDescriptor(e, k);\n        Object.defineProperty(n, k, d.get ? d : {\n          enumerable: true,\n          get: function () {\n            return e[k];\n          }\n        });\n      }\n    });\n  }\n\n  n['default'] = e;\n  return Object.freeze(n);\n}\n\nvar React__namespace = /*#__PURE__*/_interopNamespace(React);\n\nvar NextIcon = function () {\n  return React__namespace.createElement(core.Icon, {\n    size: 16\n  }, React__namespace.createElement(\"path\", {\n    d: \"M0.541,5.627L11.666,18.2c0.183,0.207,0.499,0.226,0.706,0.043c0.015-0.014,0.03-0.028,0.043-0.043\\n                L23.541,5.627\"\n  }));\n};\n\nvar PreviousIcon = function () {\n  return React__namespace.createElement(core.Icon, {\n    size: 16\n  }, React__namespace.createElement(\"path\", {\n    d: \"M23.535,18.373L12.409,5.8c-0.183-0.207-0.499-0.226-0.706-0.043C11.688,5.77,11.674,5.785,11.66,5.8\\n                L0.535,18.373\"\n  }));\n};\n\nvar SearchIcon = function () {\n  return React__namespace.createElement(core.Icon, {\n    size: 16\n  }, React__namespace.createElement(\"path\", {\n    d: \"M10.5,0.5c5.523,0,10,4.477,10,10s-4.477,10-10,10s-10-4.477-10-10S4.977,0.5,10.5,0.5z\\n                M23.5,23.5\\n                l-5.929-5.929\"\n  }));\n};\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\n\n\nvar __assign = function () {\n  __assign = Object.assign || function __assign(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nfunction __spreadArray(to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n    if (ar || !(i in from)) {\n      if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n      ar[i] = from[i];\n    }\n  }\n  return to.concat(ar || from);\n}\n\nvar EMPTY_KEYWORD_REGEXP = new RegExp(' ');\n\nvar normalizeFlagKeyword = function (flagKeyword) {\n  var source = flagKeyword.wholeWords ? \" \" + flagKeyword.keyword + \" \" : flagKeyword.keyword;\n  var flags = flagKeyword.matchCase ? 'g' : 'gi';\n  return new RegExp(source, flags);\n};\n\nvar normalizeSingleKeyword = function (keyword, matchCase, wholeWords) {\n  if (keyword instanceof RegExp) {\n    return keyword;\n  }\n\n  if (typeof keyword === 'string') {\n    return keyword === '' ? EMPTY_KEYWORD_REGEXP : normalizeFlagKeyword({\n      keyword: keyword,\n      matchCase: matchCase || false,\n      wholeWords: wholeWords || false\n    });\n  }\n\n  if (typeof matchCase !== 'undefined') {\n    keyword.matchCase = matchCase;\n  }\n\n  if (typeof wholeWords !== 'undefined') {\n    keyword.wholeWords = wholeWords;\n  }\n\n  return normalizeFlagKeyword(keyword);\n};\n\nvar useDocument = function (store) {\n  var currentDocRef = React__namespace.useRef(store.get('doc'));\n\n  var handleDocumentChanged = function (doc) {\n    currentDocRef.current = doc;\n  };\n\n  React__namespace.useEffect(function () {\n    store.subscribe('doc', handleDocumentChanged);\n    return function () {\n      store.unsubscribe('doc', handleDocumentChanged);\n    };\n  }, []);\n  return {\n    currentDoc: currentDocRef.current\n  };\n};\n\nvar useSearch = function (store) {\n  var currentDoc = useDocument(store).currentDoc;\n\n  var _a = React__namespace.useState([]),\n      keywords = _a[0],\n      setKeywords = _a[1];\n\n  var _b = React__namespace.useState([]),\n      found = _b[0],\n      setFound = _b[1];\n\n  var _c = React__namespace.useState(0),\n      currentMatch = _c[0],\n      setCurrentMatch = _c[1];\n\n  var _d = React__namespace.useState(false),\n      matchCase = _d[0],\n      setMatchCase = _d[1];\n\n  var textContents = React__namespace.useRef([]);\n\n  var _e = React__namespace.useState(false),\n      wholeWords = _e[0],\n      setWholeWords = _e[1];\n\n  var changeMatchCase = function (isChecked) {\n    setMatchCase(isChecked);\n\n    if (keywords.length > 0) {\n      searchFor(keywords, isChecked, wholeWords);\n    }\n  };\n\n  var changeWholeWords = function (isChecked) {\n    setWholeWords(isChecked);\n\n    if (keywords.length > 0) {\n      searchFor(keywords, matchCase, isChecked);\n    }\n  };\n\n  var jumpToPreviousMatch = function () {\n    if (keywords.length === 0 || found.length === 0) {\n      return;\n    }\n\n    var prev = currentMatch - 1;\n    var updated = prev > 0 ? prev : found.length;\n    setCurrentMatch(updated);\n    jumpToMatch(found[updated - 1]);\n  };\n\n  var jumpToNextMatch = function () {\n    if (keywords.length === 0 || found.length === 0) {\n      return;\n    }\n\n    var next = currentMatch + 1;\n    var updated = next <= found.length ? next : 1;\n    setCurrentMatch(updated);\n    jumpToMatch(found[updated - 1]);\n  };\n\n  var clearKeyword = function () {\n    if (keywords.length === 0) {\n      return;\n    }\n\n    store.update('keyword', [EMPTY_KEYWORD_REGEXP]);\n    setKeyword('');\n    setCurrentMatch(0);\n    setFound([]);\n    setMatchCase(false);\n    setWholeWords(false);\n  };\n\n  var search = function () {\n    return searchFor(keywords, matchCase, wholeWords);\n  };\n\n  var setKeyword = function (keyword) {\n    return setKeywords(keyword === '' ? [] : [keyword]);\n  };\n\n  var getTextContents = function () {\n    if (!currentDoc) {\n      return Promise.resolve([]);\n    }\n\n    var promises = Array(currentDoc.numPages).fill(0).map(function (_, pageIndex) {\n      return currentDoc.getPage(pageIndex + 1).then(function (page) {\n        return page.getTextContent();\n      }).then(function (content) {\n        var pageContent = content.items.map(function (item) {\n          return item.str || '';\n        }).join('');\n        return Promise.resolve({\n          pageContent: pageContent,\n          pageIndex: pageIndex\n        });\n      });\n    });\n    return Promise.all(promises).then(function (data) {\n      data.sort(function (a, b) {\n        return a.pageIndex - b.pageIndex;\n      });\n      return Promise.resolve(data.map(function (item) {\n        return item.pageContent;\n      }));\n    });\n  };\n\n  var jumpToMatch = function (match) {\n    var jumpToPage = store.get('jumpToPage');\n\n    if (jumpToPage) {\n      jumpToPage(match.pageIndex);\n    }\n\n    store.update('match', match);\n  };\n\n  var getKeywordSource = function (keyword) {\n    if (keyword instanceof RegExp) {\n      return keyword.source;\n    }\n\n    if (typeof keyword === 'string') {\n      return keyword;\n    }\n\n    return keyword.keyword;\n  };\n\n  var searchFor = function (keywordParam, matchCaseParam, wholeWordsParam) {\n    var keywords = keywordParam.map(function (k) {\n      return normalizeSingleKeyword(k, matchCaseParam, wholeWordsParam);\n    });\n    store.update('keyword', keywords);\n    setCurrentMatch(0);\n    setFound([]);\n    var promise = textContents.current.length === 0 ? getTextContents().then(function (response) {\n      textContents.current = response;\n      return Promise.resolve(response);\n    }) : Promise.resolve(textContents.current);\n    promise.then(function (response) {\n      var arr = [];\n      response.forEach(function (item, pageIndex) {\n        var numMatches = keywords.map(function (k) {\n          return (item.match(k) || []).length;\n        }).reduce(function (a, b) {\n          return a + b;\n        }, 0);\n\n        for (var matchIndex = 0; matchIndex < numMatches; matchIndex++) {\n          arr.push({\n            matchIndex: matchIndex,\n            pageIndex: pageIndex\n          });\n        }\n      });\n      setFound(arr);\n\n      if (arr.length > 0) {\n        setCurrentMatch(1);\n        jumpToMatch(arr[0]);\n      }\n    });\n  };\n\n  React__namespace.useEffect(function () {\n    textContents.current = [];\n  }, [currentDoc]);\n  return {\n    clearKeyword: clearKeyword,\n    changeMatchCase: changeMatchCase,\n    changeWholeWords: changeWholeWords,\n    currentMatch: currentMatch,\n    jumpToNextMatch: jumpToNextMatch,\n    jumpToPreviousMatch: jumpToPreviousMatch,\n    keywords: keywords,\n    matchCase: matchCase,\n    numberOfMatches: found.length,\n    wholeWords: wholeWords,\n    search: search,\n    searchFor: searchFor,\n    setKeywords: setKeywords,\n    keyword: keywords.length === 0 ? '' : getKeywordSource(keywords[0]),\n    setKeyword: setKeyword\n  };\n};\n\nvar Inner = function (_a) {\n  var children = _a.children,\n      store = _a.store;\n  var result = useSearch(store);\n  return children(__assign({}, result));\n};\n\nvar Search = function (_a) {\n  var children = _a.children,\n      store = _a.store;\n  var currentDoc = useDocument(store).currentDoc;\n  return currentDoc ? React__namespace.createElement(Inner, {\n    store: store\n  }, children) : React__namespace.createElement(React__namespace.Fragment, null);\n};\n\nvar PORTAL_OFFSET$1 = {\n  left: 0,\n  top: 8\n};\n\nvar SearchPopover = function (_a) {\n  var store = _a.store,\n      onToggle = _a.onToggle;\n  var l10n = React__namespace.useContext(core.LocalizationContext);\n\n  var _b = useSearch(store),\n      clearKeyword = _b.clearKeyword,\n      changeMatchCase = _b.changeMatchCase,\n      changeWholeWords = _b.changeWholeWords,\n      currentMatch = _b.currentMatch,\n      jumpToNextMatch = _b.jumpToNextMatch,\n      jumpToPreviousMatch = _b.jumpToPreviousMatch,\n      keyword = _b.keyword,\n      matchCase = _b.matchCase,\n      numberOfMatches = _b.numberOfMatches,\n      wholeWords = _b.wholeWords,\n      search = _b.search,\n      setKeyword = _b.setKeyword;\n\n  var onKeydownSearch = function (e) {\n    if (e.keyCode !== 13 || !keyword) {\n      return;\n    }\n\n    search();\n  };\n\n  var onChangeMatchCase = function (e) {\n    changeMatchCase(e.target.checked);\n  };\n\n  var onChangeWholeWords = function (e) {\n    changeWholeWords(e.target.checked);\n  };\n\n  var onClose = function () {\n    onToggle();\n    clearKeyword();\n  };\n\n  return React__namespace.createElement(\"div\", {\n    className: \"rpv-search__popover\"\n  }, React__namespace.createElement(\"div\", {\n    className: \"rpv-search__popover-input-counter\"\n  }, React__namespace.createElement(core.TextBox, {\n    placeholder: l10n && l10n.search ? l10n.search.enterToSearch : 'Enter to search',\n    type: \"text\",\n    value: keyword,\n    onChange: setKeyword,\n    onKeyDown: onKeydownSearch\n  }), React__namespace.createElement(\"div\", {\n    className: \"rpv-search__popover-counter\"\n  }, currentMatch, \"/\", numberOfMatches)), React__namespace.createElement(\"label\", {\n    className: \"rpv-search__popover-label\"\n  }, React__namespace.createElement(\"input\", {\n    className: \"rpv-search__popover-label-checkbox\",\n    checked: matchCase,\n    type: \"checkbox\",\n    onChange: onChangeMatchCase\n  }), ' ', l10n && l10n.search ? l10n.search.matchCase : 'Match case'), React__namespace.createElement(\"label\", {\n    className: \"rpv-search__popover-label\"\n  }, React__namespace.createElement(\"input\", {\n    className: \"rpv-search__popover-label-checkbox\",\n    checked: wholeWords,\n    type: \"checkbox\",\n    onChange: onChangeWholeWords\n  }), ' ', l10n && l10n.search ? l10n.search.wholeWords : 'Whole words'), React__namespace.createElement(\"div\", {\n    className: \"rpv-search__popover-footer\"\n  }, React__namespace.createElement(\"div\", {\n    className: \"rpv-search__popover-footer-item\"\n  }, React__namespace.createElement(core.Tooltip, {\n    position: core.Position.BottomCenter,\n    target: React__namespace.createElement(core.MinimalButton, {\n      onClick: jumpToPreviousMatch\n    }, React__namespace.createElement(PreviousIcon, null)),\n    content: function () {\n      return l10n && l10n.search ? l10n.search.previousMatch : 'Previous match';\n    },\n    offset: PORTAL_OFFSET$1\n  })), React__namespace.createElement(\"div\", {\n    className: \"rpv-search__popover-footer-item\"\n  }, React__namespace.createElement(core.Tooltip, {\n    position: core.Position.BottomCenter,\n    target: React__namespace.createElement(core.MinimalButton, {\n      onClick: jumpToNextMatch\n    }, React__namespace.createElement(NextIcon, null)),\n    content: function () {\n      return l10n && l10n.search ? l10n.search.nextMatch : 'Next match';\n    },\n    offset: PORTAL_OFFSET$1\n  })), React__namespace.createElement(\"div\", {\n    className: \"rpv-search__popover-footer-button\"\n  }, React__namespace.createElement(core.Button, {\n    onClick: onClose\n  }, l10n && l10n.search ? l10n.search.close : 'Close'))));\n};\n\nvar ShowSearchPopoverDecorator = function (_a) {\n  var children = _a.children,\n      onClick = _a.onClick;\n  var l10n = React__namespace.useContext(core.LocalizationContext);\n  var label = l10n && l10n.search ? l10n.search.search : 'Search';\n  var icon = React__namespace.createElement(SearchIcon, null);\n  return children({\n    icon: icon,\n    label: label,\n    onClick: onClick\n  });\n};\n\nvar TOOLTIP_OFFSET = {\n  left: 0,\n  top: 8\n};\n\nvar ShowSearchPopoverButton = function (_a) {\n  var onClick = _a.onClick;\n  return React__namespace.createElement(ShowSearchPopoverDecorator, {\n    onClick: onClick\n  }, function (p) {\n    return React__namespace.createElement(core.Tooltip, {\n      position: core.Position.BottomCenter,\n      target: React__namespace.createElement(core.MinimalButton, {\n        onClick: onClick\n      }, p.icon),\n      content: function () {\n        return p.label;\n      },\n      offset: TOOLTIP_OFFSET\n    });\n  });\n};\n\nvar PORTAL_OFFSET = {\n  left: 0,\n  top: 8\n};\n\nvar ShowSearchPopover = function (_a) {\n  var children = _a.children,\n      store = _a.store;\n  var currentDoc = useDocument(store).currentDoc;\n\n  var defaultChildren = function (props) {\n    return React__namespace.createElement(ShowSearchPopoverButton, __assign({}, props));\n  };\n\n  var render = children || defaultChildren;\n  return currentDoc ? React__namespace.createElement(core.Popover, {\n    position: core.Position.BottomLeft,\n    target: function (toggle) {\n      return render({\n        onClick: toggle\n      });\n    },\n    content: function (toggle) {\n      return React__namespace.createElement(SearchPopover, {\n        store: store,\n        onToggle: toggle\n      });\n    },\n    offset: PORTAL_OFFSET,\n    closeOnClickOutside: false,\n    closeOnEscape: true\n  }) : React__namespace.createElement(React__namespace.Fragment, null);\n};\n\nvar calculateOffset = function (children, parent) {\n  var top = children.offsetTop;\n  var left = children.offsetLeft;\n  var p = children.parentElement;\n\n  while (p && p !== parent) {\n    top += p.offsetTop;\n    left += p.offsetLeft;\n    p = p.parentElement;\n  }\n\n  return {\n    left: left,\n    top: top\n  };\n};\n\nvar removeNode = function (ele) {\n  var parent = ele.parentNode;\n\n  if (parent) {\n    parent.removeChild(ele);\n  }\n};\n\nvar replaceNode = function (replacementNode, node) {\n  removeNode(replacementNode);\n  var parent = node.parentNode;\n\n  if (parent) {\n    parent.insertBefore(replacementNode, node);\n  }\n\n  removeNode(node);\n};\n\nvar unwrap = function (ele) {\n  var parent = ele.parentNode;\n\n  if (!parent) {\n    return;\n  }\n\n  var range = document.createRange();\n  range.selectNodeContents(ele);\n  replaceNode(range.extractContents(), ele);\n  parent.normalize();\n};\n\nvar Tracker = function (_a) {\n  var pageIndex = _a.pageIndex,\n      store = _a.store,\n      onHighlightKeyword = _a.onHighlightKeyword;\n\n  var _b = React__namespace.useState({\n    matchIndex: -1,\n    pageIndex: -1\n  }),\n      match = _b[0],\n      setMatch = _b[1];\n\n  var _c = React__namespace.useState([EMPTY_KEYWORD_REGEXP]),\n      keywordRegexp = _c[0],\n      setKeywordRegexp = _c[1];\n\n  var _d = React__namespace.useState({\n    pageIndex: pageIndex,\n    scale: 1,\n    status: core.LayerRenderStatus.PreRender\n  }),\n      renderStatus = _d[0],\n      setRenderStatus = _d[1];\n\n  var currentMatchRef = React__namespace.useRef(null);\n  var characterIndexesRef = React__namespace.useRef([]);\n\n  var unhighlightAll = function (containerEle) {\n    var highlightNodes = containerEle.querySelectorAll('span.rpv-search__highlight');\n    var total = highlightNodes.length;\n\n    for (var i = 0; i < total; i++) {\n      highlightNodes[i].parentElement.removeChild(highlightNodes[i]);\n    }\n  };\n\n  var highlight = function (keyword, containerEle, span, charIndexSpan) {\n    var range = document.createRange();\n    var firstChild = span.firstChild;\n\n    if (!firstChild) {\n      return;\n    }\n\n    var startOffset = charIndexSpan[0].charIndexInSpan;\n    var endOffset = charIndexSpan.length === 1 ? startOffset : charIndexSpan[charIndexSpan.length - 1].charIndexInSpan;\n    range.setStart(firstChild, startOffset);\n    range.setEnd(firstChild, endOffset + 1);\n    var wrapper = document.createElement('span');\n    range.surroundContents(wrapper);\n    var wrapperRect = wrapper.getBoundingClientRect();\n    var containerRect = containerEle.getBoundingClientRect();\n    var highlightEle = document.createElement('span');\n    containerEle.appendChild(highlightEle);\n    highlightEle.style.left = 100 * (wrapperRect.left - containerRect.left) / containerRect.width + \"%\";\n    highlightEle.style.top = 100 * (wrapperRect.top - containerRect.top) / containerRect.height + \"%\";\n    highlightEle.style.width = 100 * wrapperRect.width / containerRect.width + \"%\";\n    highlightEle.style.height = 100 * wrapperRect.height / containerRect.height + \"%\";\n    highlightEle.classList.add('rpv-search__highlight');\n    highlightEle.setAttribute('title', keyword.source.trim());\n    unwrap(wrapper);\n\n    if (onHighlightKeyword) {\n      onHighlightKeyword({\n        highlightEle: highlightEle,\n        keyword: keyword\n      });\n    }\n  };\n\n  var highlightAll = function (containerEle) {\n    var charIndexes = characterIndexesRef.current;\n\n    if (charIndexes.length === 0) {\n      return;\n    }\n\n    var spans = [].slice.call(containerEle.querySelectorAll('.rpv-core__text-layer-text'));\n    var fullText = charIndexes.map(function (item) {\n      return item.char;\n    }).join('');\n    keywordRegexp.forEach(function (keyword) {\n      var keywordStr = keyword.source;\n\n      if (!keywordStr.trim()) {\n        return;\n      }\n\n      var cloneKeyword = keyword.flags.indexOf('g') === -1 ? new RegExp(keyword, keyword.flags + \"g\") : keyword;\n      var match;\n      var matches = [];\n\n      while ((match = cloneKeyword.exec(fullText)) !== null) {\n        matches.push({\n          keyword: cloneKeyword,\n          startIndex: match.index,\n          endIndex: cloneKeyword.lastIndex\n        });\n      }\n\n      matches.map(function (item) {\n        return {\n          keyword: item.keyword,\n          indexes: charIndexes.slice(item.startIndex, item.endIndex)\n        };\n      }).forEach(function (item) {\n        var spanIndexes = item.indexes.reduce(function (acc, item) {\n          acc[item.spanIndex] = __spreadArray(__spreadArray([], acc[item.spanIndex] || []), [item]);\n          return acc;\n        }, {});\n        Object.values(spanIndexes).forEach(function (charIndexSpan) {\n          highlight(item.keyword, containerEle, spans[charIndexSpan[0].spanIndex], charIndexSpan);\n        });\n      });\n    });\n  };\n\n  var handleKeywordChanged = function (keyword) {\n    if (keyword && keyword.length > 0) {\n      setKeywordRegexp(keyword);\n    }\n  };\n\n  var handleMatchChanged = function (currentMatch) {\n    setMatch(currentMatch);\n  };\n\n  var handleRenderStatusChanged = function (status) {\n    if (!status.has(pageIndex)) {\n      return;\n    }\n\n    var currentStatus = status.get(pageIndex);\n\n    if (currentStatus) {\n      setRenderStatus({\n        ele: currentStatus.ele,\n        pageIndex: pageIndex,\n        scale: currentStatus.scale,\n        status: currentStatus.status\n      });\n    }\n  };\n\n  var isEmptyKeyword = function () {\n    return keywordRegexp.length === 0 || keywordRegexp.length === 1 && keywordRegexp[0].source.trim() === '';\n  };\n\n  React__namespace.useEffect(function () {\n    if (isEmptyKeyword() || renderStatus.status !== core.LayerRenderStatus.DidRender || characterIndexesRef.current.length) {\n      return;\n    }\n\n    var containerEle = renderStatus.ele;\n    var spans = [].slice.call(containerEle.querySelectorAll('.rpv-core__text-layer-text'));\n    var charIndexes = spans.map(function (span) {\n      return span.textContent;\n    }).reduce(function (prev, curr, index) {\n      return prev.concat(curr.split('').map(function (c, i) {\n        return {\n          char: c,\n          charIndexInSpan: i,\n          spanIndex: index\n        };\n      }));\n    }, [{\n      char: '',\n      charIndexInSpan: 0,\n      spanIndex: 0\n    }]).slice(1);\n    characterIndexesRef.current = charIndexes;\n  }, [keywordRegexp, renderStatus.status]);\n  React__namespace.useEffect(function () {\n    if (isEmptyKeyword() || !renderStatus.ele || renderStatus.status !== core.LayerRenderStatus.DidRender) {\n      return;\n    }\n\n    var containerEle = renderStatus.ele;\n    unhighlightAll(containerEle);\n    highlightAll(containerEle);\n    scrollToMatch();\n  }, [keywordRegexp, match, renderStatus.status, characterIndexesRef.current]);\n  React__namespace.useEffect(function () {\n    if (isEmptyKeyword() && renderStatus.ele && renderStatus.status === core.LayerRenderStatus.DidRender) {\n      unhighlightAll(renderStatus.ele);\n    }\n  }, [keywordRegexp, renderStatus.status]);\n\n  var scrollToMatch = function () {\n    if (match.pageIndex !== pageIndex || !renderStatus.ele || renderStatus.status !== core.LayerRenderStatus.DidRender) {\n      return;\n    }\n\n    var container = renderStatus.ele;\n    var spans = container.querySelectorAll('.rpv-search__highlight');\n\n    if (match.matchIndex < spans.length) {\n      var span = spans[match.matchIndex];\n\n      var _a = calculateOffset(span, container),\n          left = _a.left,\n          top_1 = _a.top;\n\n      var jump = store.get('jumpToDestination');\n\n      if (jump) {\n        jump(pageIndex, (container.getBoundingClientRect().height - top_1) / renderStatus.scale, left / renderStatus.scale, renderStatus.scale);\n\n        if (currentMatchRef.current) {\n          currentMatchRef.current.classList.remove('rpv-search__highlight--current');\n        }\n\n        currentMatchRef.current = span;\n        span.classList.add('rpv-search__highlight--current');\n      }\n    }\n  };\n\n  React__namespace.useEffect(function () {\n    store.subscribe('keyword', handleKeywordChanged);\n    store.subscribe('match', handleMatchChanged);\n    store.subscribe('renderStatus', handleRenderStatusChanged);\n    return function () {\n      store.unsubscribe('keyword', handleKeywordChanged);\n      store.unsubscribe('match', handleMatchChanged);\n      store.unsubscribe('renderStatus', handleRenderStatusChanged);\n    };\n  }, []);\n  return React__namespace.createElement(React__namespace.Fragment, null);\n};\n\nvar searchPlugin = function (props) {\n  var onHighlightKeyword = React__namespace.useMemo(function () {\n    return props && props.onHighlightKeyword ? props.onHighlightKeyword : function () {};\n  }, []);\n  var store = React__namespace.useMemo(function () {\n    return core.createStore({\n      renderStatus: new Map()\n    });\n  }, []);\n\n  var _a = useSearch(store),\n      clearKeyword = _a.clearKeyword,\n      jumpToNextMatch = _a.jumpToNextMatch,\n      jumpToPreviousMatch = _a.jumpToPreviousMatch,\n      searchFor = _a.searchFor,\n      setKeywords = _a.setKeywords;\n\n  var SearchDecorator = function (props) {\n    return React__namespace.createElement(Search, __assign({}, props, {\n      store: store\n    }));\n  };\n\n  var ShowSearchPopoverDecorator = function (props) {\n    return React__namespace.createElement(ShowSearchPopover, __assign({}, props, {\n      store: store\n    }));\n  };\n\n  var ShowSearchPopoverButtonDecorator = function () {\n    return React__namespace.createElement(ShowSearchPopoverDecorator, null, function (props) {\n      return React__namespace.createElement(ShowSearchPopoverButton, __assign({}, props));\n    });\n  };\n\n  var renderViewer = function (renderViewerProps) {\n    var currentSlot = renderViewerProps.slot;\n\n    if (currentSlot.subSlot) {\n      currentSlot.subSlot.children = React__namespace.createElement(React__namespace.Fragment, null, Array(renderViewerProps.doc.numPages).fill(0).map(function (_, index) {\n        return React__namespace.createElement(Tracker, {\n          key: index,\n          pageIndex: index,\n          store: store,\n          onHighlightKeyword: onHighlightKeyword\n        });\n      }), currentSlot.subSlot.children);\n    }\n\n    return currentSlot;\n  };\n\n  var normalizeKeywords = function (keyword) {\n    return Array.isArray(keyword) ? keyword.map(function (k) {\n      return normalizeSingleKeyword(k);\n    }) : [normalizeSingleKeyword(keyword)];\n  };\n\n  return {\n    install: function (pluginFunctions) {\n      var keyword = props && props.keyword ? normalizeKeywords(props.keyword) : [EMPTY_KEYWORD_REGEXP];\n      store.update('jumpToDestination', pluginFunctions.jumpToDestination);\n      store.update('jumpToPage', pluginFunctions.jumpToPage);\n      store.update('keyword', keyword);\n    },\n    renderViewer: renderViewer,\n    uninstall: function (props) {\n      var renderStatus = store.get('renderStatus');\n\n      if (renderStatus) {\n        renderStatus.clear();\n      }\n    },\n    onDocumentLoad: function (props) {\n      store.update('doc', props.doc);\n    },\n    onTextLayerRender: function (props) {\n      var renderStatus = store.get('renderStatus');\n\n      if (renderStatus) {\n        renderStatus = renderStatus.set(props.pageIndex, props);\n        store.update('renderStatus', renderStatus);\n      }\n    },\n    Search: SearchDecorator,\n    ShowSearchPopover: ShowSearchPopoverDecorator,\n    ShowSearchPopoverButton: ShowSearchPopoverButtonDecorator,\n    clearHighlights: function () {\n      clearKeyword();\n    },\n    highlight: function (keyword) {\n      var keywords = Array.isArray(keyword) ? keyword : [keyword];\n      setKeywords(keywords);\n      searchFor(keywords);\n    },\n    jumpToNextMatch: jumpToNextMatch,\n    jumpToPreviousMatch: jumpToPreviousMatch\n  };\n};\n\nexports.NextIcon = NextIcon;\nexports.PreviousIcon = PreviousIcon;\nexports.SearchIcon = SearchIcon;\nexports.searchPlugin = searchPlugin;","map":{"version":3,"sources":["/Users/kzjouf/Desktop/project/sc-dapp/node_modules/@react-pdf-viewer/search/lib/cjs/search.js"],"names":["Object","defineProperty","exports","value","React","require","core","_interopNamespace","e","__esModule","n","create","keys","forEach","k","d","getOwnPropertyDescriptor","get","enumerable","freeze","React__namespace","NextIcon","createElement","Icon","size","PreviousIcon","SearchIcon","__assign","assign","t","s","i","arguments","length","p","prototype","hasOwnProperty","call","apply","__spreadArray","to","from","pack","l","ar","Array","slice","concat","EMPTY_KEYWORD_REGEXP","RegExp","normalizeFlagKeyword","flagKeyword","source","wholeWords","keyword","flags","matchCase","normalizeSingleKeyword","useDocument","store","currentDocRef","useRef","handleDocumentChanged","doc","current","useEffect","subscribe","unsubscribe","currentDoc","useSearch","_a","useState","keywords","setKeywords","_b","found","setFound","_c","currentMatch","setCurrentMatch","_d","setMatchCase","textContents","_e","setWholeWords","changeMatchCase","isChecked","searchFor","changeWholeWords","jumpToPreviousMatch","prev","updated","jumpToMatch","jumpToNextMatch","next","clearKeyword","update","setKeyword","search","getTextContents","Promise","resolve","promises","numPages","fill","map","_","pageIndex","getPage","then","page","getTextContent","content","pageContent","items","item","str","join","all","data","sort","a","b","match","jumpToPage","getKeywordSource","keywordParam","matchCaseParam","wholeWordsParam","promise","response","arr","numMatches","reduce","matchIndex","push","numberOfMatches","Inner","children","result","Search","Fragment","PORTAL_OFFSET$1","left","top","SearchPopover","onToggle","l10n","useContext","LocalizationContext","onKeydownSearch","keyCode","onChangeMatchCase","target","checked","onChangeWholeWords","onClose","className","TextBox","placeholder","enterToSearch","type","onChange","onKeyDown","Tooltip","position","Position","BottomCenter","MinimalButton","onClick","previousMatch","offset","nextMatch","Button","close","ShowSearchPopoverDecorator","label","icon","TOOLTIP_OFFSET","ShowSearchPopoverButton","PORTAL_OFFSET","ShowSearchPopover","defaultChildren","props","render","Popover","BottomLeft","toggle","closeOnClickOutside","closeOnEscape","calculateOffset","parent","offsetTop","offsetLeft","parentElement","removeNode","ele","parentNode","removeChild","replaceNode","replacementNode","node","insertBefore","unwrap","range","document","createRange","selectNodeContents","extractContents","normalize","Tracker","onHighlightKeyword","setMatch","keywordRegexp","setKeywordRegexp","scale","status","LayerRenderStatus","PreRender","renderStatus","setRenderStatus","currentMatchRef","characterIndexesRef","unhighlightAll","containerEle","highlightNodes","querySelectorAll","total","highlight","span","charIndexSpan","firstChild","startOffset","charIndexInSpan","endOffset","setStart","setEnd","wrapper","surroundContents","wrapperRect","getBoundingClientRect","containerRect","highlightEle","appendChild","style","width","height","classList","add","setAttribute","trim","highlightAll","charIndexes","spans","fullText","char","keywordStr","cloneKeyword","indexOf","matches","exec","startIndex","index","endIndex","lastIndex","indexes","spanIndexes","acc","spanIndex","values","handleKeywordChanged","handleMatchChanged","handleRenderStatusChanged","has","currentStatus","isEmptyKeyword","DidRender","textContent","curr","split","c","scrollToMatch","container","top_1","jump","remove","searchPlugin","useMemo","createStore","Map","SearchDecorator","ShowSearchPopoverButtonDecorator","renderViewer","renderViewerProps","currentSlot","slot","subSlot","key","normalizeKeywords","isArray","install","pluginFunctions","jumpToDestination","uninstall","clear","onDocumentLoad","onTextLayerRender","set","clearHighlights"],"mappings":"AAAA;;AAEAA,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;AAAEC,EAAAA,KAAK,EAAE;AAAT,CAA7C;;AAEA,IAAIC,KAAK,GAAGC,OAAO,CAAC,OAAD,CAAnB;;AACA,IAAIC,IAAI,GAAGD,OAAO,CAAC,wBAAD,CAAlB;;AAEA,SAASE,iBAAT,CAA2BC,CAA3B,EAA8B;AAC1B,MAAIA,CAAC,IAAIA,CAAC,CAACC,UAAX,EAAuB,OAAOD,CAAP;AACvB,MAAIE,CAAC,GAAGV,MAAM,CAACW,MAAP,CAAc,IAAd,CAAR;;AACA,MAAIH,CAAJ,EAAO;AACHR,IAAAA,MAAM,CAACY,IAAP,CAAYJ,CAAZ,EAAeK,OAAf,CAAuB,UAAUC,CAAV,EAAa;AAChC,UAAIA,CAAC,KAAK,SAAV,EAAqB;AACjB,YAAIC,CAAC,GAAGf,MAAM,CAACgB,wBAAP,CAAgCR,CAAhC,EAAmCM,CAAnC,CAAR;AACAd,QAAAA,MAAM,CAACC,cAAP,CAAsBS,CAAtB,EAAyBI,CAAzB,EAA4BC,CAAC,CAACE,GAAF,GAAQF,CAAR,GAAY;AACpCG,UAAAA,UAAU,EAAE,IADwB;AAEpCD,UAAAA,GAAG,EAAE,YAAY;AACb,mBAAOT,CAAC,CAACM,CAAD,CAAR;AACH;AAJmC,SAAxC;AAMH;AACJ,KAVD;AAWH;;AACDJ,EAAAA,CAAC,CAAC,SAAD,CAAD,GAAeF,CAAf;AACA,SAAOR,MAAM,CAACmB,MAAP,CAAcT,CAAd,CAAP;AACH;;AAED,IAAIU,gBAAgB,GAAG,aAAab,iBAAiB,CAACH,KAAD,CAArD;;AAEA,IAAIiB,QAAQ,GAAG,YAAY;AACvB,SAAQD,gBAAgB,CAACE,aAAjB,CAA+BhB,IAAI,CAACiB,IAApC,EAA0C;AAAEC,IAAAA,IAAI,EAAE;AAAR,GAA1C,EACJJ,gBAAgB,CAACE,aAAjB,CAA+B,MAA/B,EAAuC;AAAEP,IAAAA,CAAC,EAAE;AAAL,GAAvC,CADI,CAAR;AAEH,CAHD;;AAKA,IAAIU,YAAY,GAAG,YAAY;AAC3B,SAAQL,gBAAgB,CAACE,aAAjB,CAA+BhB,IAAI,CAACiB,IAApC,EAA0C;AAAEC,IAAAA,IAAI,EAAE;AAAR,GAA1C,EACJJ,gBAAgB,CAACE,aAAjB,CAA+B,MAA/B,EAAuC;AAAEP,IAAAA,CAAC,EAAE;AAAL,GAAvC,CADI,CAAR;AAEH,CAHD;;AAKA,IAAIW,UAAU,GAAG,YAAY;AACzB,SAAQN,gBAAgB,CAACE,aAAjB,CAA+BhB,IAAI,CAACiB,IAApC,EAA0C;AAAEC,IAAAA,IAAI,EAAE;AAAR,GAA1C,EACJJ,gBAAgB,CAACE,aAAjB,CAA+B,MAA/B,EAAuC;AAAEP,IAAAA,CAAC,EAAE;AAAL,GAAvC,CADI,CAAR;AAEH,CAHD;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEA,IAAIY,QAAQ,GAAG,YAAW;AACtBA,EAAAA,QAAQ,GAAG3B,MAAM,CAAC4B,MAAP,IAAiB,SAASD,QAAT,CAAkBE,CAAlB,EAAqB;AAC7C,SAAK,IAAIC,CAAJ,EAAOC,CAAC,GAAG,CAAX,EAAcrB,CAAC,GAAGsB,SAAS,CAACC,MAAjC,EAAyCF,CAAC,GAAGrB,CAA7C,EAAgDqB,CAAC,EAAjD,EAAqD;AACjDD,MAAAA,CAAC,GAAGE,SAAS,CAACD,CAAD,CAAb;;AACA,WAAK,IAAIG,CAAT,IAAcJ,CAAd,EAAiB,IAAI9B,MAAM,CAACmC,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqCP,CAArC,EAAwCI,CAAxC,CAAJ,EAAgDL,CAAC,CAACK,CAAD,CAAD,GAAOJ,CAAC,CAACI,CAAD,CAAR;AACpE;;AACD,WAAOL,CAAP;AACH,GAND;;AAOA,SAAOF,QAAQ,CAACW,KAAT,CAAe,IAAf,EAAqBN,SAArB,CAAP;AACH,CATD;;AAWA,SAASO,aAAT,CAAuBC,EAAvB,EAA2BC,IAA3B,EAAiCC,IAAjC,EAAuC;AACnC,MAAIA,IAAI,IAAIV,SAAS,CAACC,MAAV,KAAqB,CAAjC,EAAoC,KAAK,IAAIF,CAAC,GAAG,CAAR,EAAWY,CAAC,GAAGF,IAAI,CAACR,MAApB,EAA4BW,EAAjC,EAAqCb,CAAC,GAAGY,CAAzC,EAA4CZ,CAAC,EAA7C,EAAiD;AACjF,QAAIa,EAAE,IAAI,EAAEb,CAAC,IAAIU,IAAP,CAAV,EAAwB;AACpB,UAAI,CAACG,EAAL,EAASA,EAAE,GAAGC,KAAK,CAACV,SAAN,CAAgBW,KAAhB,CAAsBT,IAAtB,CAA2BI,IAA3B,EAAiC,CAAjC,EAAoCV,CAApC,CAAL;AACTa,MAAAA,EAAE,CAACb,CAAD,CAAF,GAAQU,IAAI,CAACV,CAAD,CAAZ;AACH;AACJ;AACD,SAAOS,EAAE,CAACO,MAAH,CAAUH,EAAE,IAAIH,IAAhB,CAAP;AACH;;AAED,IAAIO,oBAAoB,GAAG,IAAIC,MAAJ,CAAW,GAAX,CAA3B;;AAEA,IAAIC,oBAAoB,GAAG,UAAUC,WAAV,EAAuB;AAC9C,MAAIC,MAAM,GAAGD,WAAW,CAACE,UAAZ,GAAyB,MAAMF,WAAW,CAACG,OAAlB,GAA4B,GAArD,GAA2DH,WAAW,CAACG,OAApF;AACA,MAAIC,KAAK,GAAGJ,WAAW,CAACK,SAAZ,GAAwB,GAAxB,GAA8B,IAA1C;AACA,SAAO,IAAIP,MAAJ,CAAWG,MAAX,EAAmBG,KAAnB,CAAP;AACH,CAJD;;AAKA,IAAIE,sBAAsB,GAAG,UAAUH,OAAV,EAAmBE,SAAnB,EAA8BH,UAA9B,EAA0C;AACnE,MAAIC,OAAO,YAAYL,MAAvB,EAA+B;AAC3B,WAAOK,OAAP;AACH;;AACD,MAAI,OAAOA,OAAP,KAAmB,QAAvB,EAAiC;AAC7B,WAAOA,OAAO,KAAK,EAAZ,GACDN,oBADC,GAEDE,oBAAoB,CAAC;AACnBI,MAAAA,OAAO,EAAEA,OADU;AAEnBE,MAAAA,SAAS,EAAEA,SAAS,IAAI,KAFL;AAGnBH,MAAAA,UAAU,EAAEA,UAAU,IAAI;AAHP,KAAD,CAF1B;AAOH;;AACD,MAAI,OAAOG,SAAP,KAAqB,WAAzB,EAAsC;AAClCF,IAAAA,OAAO,CAACE,SAAR,GAAoBA,SAApB;AACH;;AACD,MAAI,OAAOH,UAAP,KAAsB,WAA1B,EAAuC;AACnCC,IAAAA,OAAO,CAACD,UAAR,GAAqBA,UAArB;AACH;;AACD,SAAOH,oBAAoB,CAACI,OAAD,CAA3B;AACH,CApBD;;AAsBA,IAAII,WAAW,GAAG,UAAUC,KAAV,EAAiB;AAC/B,MAAIC,aAAa,GAAGxC,gBAAgB,CAACyC,MAAjB,CAAwBF,KAAK,CAAC1C,GAAN,CAAU,KAAV,CAAxB,CAApB;;AACA,MAAI6C,qBAAqB,GAAG,UAAUC,GAAV,EAAe;AACvCH,IAAAA,aAAa,CAACI,OAAd,GAAwBD,GAAxB;AACH,GAFD;;AAGA3C,EAAAA,gBAAgB,CAAC6C,SAAjB,CAA2B,YAAY;AACnCN,IAAAA,KAAK,CAACO,SAAN,CAAgB,KAAhB,EAAuBJ,qBAAvB;AACA,WAAO,YAAY;AACfH,MAAAA,KAAK,CAACQ,WAAN,CAAkB,KAAlB,EAAyBL,qBAAzB;AACH,KAFD;AAGH,GALD,EAKG,EALH;AAMA,SAAO;AAAEM,IAAAA,UAAU,EAAER,aAAa,CAACI;AAA5B,GAAP;AACH,CAZD;;AAcA,IAAIK,SAAS,GAAG,UAAUV,KAAV,EAAiB;AAC7B,MAAIS,UAAU,GAAGV,WAAW,CAACC,KAAD,CAAX,CAAmBS,UAApC;;AACA,MAAIE,EAAE,GAAGlD,gBAAgB,CAACmD,QAAjB,CAA0B,EAA1B,CAAT;AAAA,MAAwCC,QAAQ,GAAGF,EAAE,CAAC,CAAD,CAArD;AAAA,MAA0DG,WAAW,GAAGH,EAAE,CAAC,CAAD,CAA1E;;AACA,MAAII,EAAE,GAAGtD,gBAAgB,CAACmD,QAAjB,CAA0B,EAA1B,CAAT;AAAA,MAAwCI,KAAK,GAAGD,EAAE,CAAC,CAAD,CAAlD;AAAA,MAAuDE,QAAQ,GAAGF,EAAE,CAAC,CAAD,CAApE;;AACA,MAAIG,EAAE,GAAGzD,gBAAgB,CAACmD,QAAjB,CAA0B,CAA1B,CAAT;AAAA,MAAuCO,YAAY,GAAGD,EAAE,CAAC,CAAD,CAAxD;AAAA,MAA6DE,eAAe,GAAGF,EAAE,CAAC,CAAD,CAAjF;;AACA,MAAIG,EAAE,GAAG5D,gBAAgB,CAACmD,QAAjB,CAA0B,KAA1B,CAAT;AAAA,MAA2Cf,SAAS,GAAGwB,EAAE,CAAC,CAAD,CAAzD;AAAA,MAA8DC,YAAY,GAAGD,EAAE,CAAC,CAAD,CAA/E;;AACA,MAAIE,YAAY,GAAG9D,gBAAgB,CAACyC,MAAjB,CAAwB,EAAxB,CAAnB;;AACA,MAAIsB,EAAE,GAAG/D,gBAAgB,CAACmD,QAAjB,CAA0B,KAA1B,CAAT;AAAA,MAA2ClB,UAAU,GAAG8B,EAAE,CAAC,CAAD,CAA1D;AAAA,MAA+DC,aAAa,GAAGD,EAAE,CAAC,CAAD,CAAjF;;AACA,MAAIE,eAAe,GAAG,UAAUC,SAAV,EAAqB;AACvCL,IAAAA,YAAY,CAACK,SAAD,CAAZ;;AACA,QAAId,QAAQ,CAACvC,MAAT,GAAkB,CAAtB,EAAyB;AACrBsD,MAAAA,SAAS,CAACf,QAAD,EAAWc,SAAX,EAAsBjC,UAAtB,CAAT;AACH;AACJ,GALD;;AAMA,MAAImC,gBAAgB,GAAG,UAAUF,SAAV,EAAqB;AACxCF,IAAAA,aAAa,CAACE,SAAD,CAAb;;AACA,QAAId,QAAQ,CAACvC,MAAT,GAAkB,CAAtB,EAAyB;AACrBsD,MAAAA,SAAS,CAACf,QAAD,EAAWhB,SAAX,EAAsB8B,SAAtB,CAAT;AACH;AACJ,GALD;;AAMA,MAAIG,mBAAmB,GAAG,YAAY;AAClC,QAAIjB,QAAQ,CAACvC,MAAT,KAAoB,CAApB,IAAyB0C,KAAK,CAAC1C,MAAN,KAAiB,CAA9C,EAAiD;AAC7C;AACH;;AACD,QAAIyD,IAAI,GAAGZ,YAAY,GAAG,CAA1B;AACA,QAAIa,OAAO,GAAGD,IAAI,GAAG,CAAP,GAAWA,IAAX,GAAkBf,KAAK,CAAC1C,MAAtC;AACA8C,IAAAA,eAAe,CAACY,OAAD,CAAf;AACAC,IAAAA,WAAW,CAACjB,KAAK,CAACgB,OAAO,GAAG,CAAX,CAAN,CAAX;AACH,GARD;;AASA,MAAIE,eAAe,GAAG,YAAY;AAC9B,QAAIrB,QAAQ,CAACvC,MAAT,KAAoB,CAApB,IAAyB0C,KAAK,CAAC1C,MAAN,KAAiB,CAA9C,EAAiD;AAC7C;AACH;;AACD,QAAI6D,IAAI,GAAGhB,YAAY,GAAG,CAA1B;AACA,QAAIa,OAAO,GAAGG,IAAI,IAAInB,KAAK,CAAC1C,MAAd,GAAuB6D,IAAvB,GAA8B,CAA5C;AACAf,IAAAA,eAAe,CAACY,OAAD,CAAf;AACAC,IAAAA,WAAW,CAACjB,KAAK,CAACgB,OAAO,GAAG,CAAX,CAAN,CAAX;AACH,GARD;;AASA,MAAII,YAAY,GAAG,YAAY;AAC3B,QAAIvB,QAAQ,CAACvC,MAAT,KAAoB,CAAxB,EAA2B;AACvB;AACH;;AACD0B,IAAAA,KAAK,CAACqC,MAAN,CAAa,SAAb,EAAwB,CAAChD,oBAAD,CAAxB;AACAiD,IAAAA,UAAU,CAAC,EAAD,CAAV;AACAlB,IAAAA,eAAe,CAAC,CAAD,CAAf;AACAH,IAAAA,QAAQ,CAAC,EAAD,CAAR;AACAK,IAAAA,YAAY,CAAC,KAAD,CAAZ;AACAG,IAAAA,aAAa,CAAC,KAAD,CAAb;AACH,GAVD;;AAWA,MAAIc,MAAM,GAAG,YAAY;AAAE,WAAOX,SAAS,CAACf,QAAD,EAAWhB,SAAX,EAAsBH,UAAtB,CAAhB;AAAoD,GAA/E;;AACA,MAAI4C,UAAU,GAAG,UAAU3C,OAAV,EAAmB;AAAE,WAAOmB,WAAW,CAACnB,OAAO,KAAK,EAAZ,GAAiB,EAAjB,GAAsB,CAACA,OAAD,CAAvB,CAAlB;AAAsD,GAA5F;;AACA,MAAI6C,eAAe,GAAG,YAAY;AAC9B,QAAI,CAAC/B,UAAL,EAAiB;AACb,aAAOgC,OAAO,CAACC,OAAR,CAAgB,EAAhB,CAAP;AACH;;AACD,QAAIC,QAAQ,GAAGzD,KAAK,CAACuB,UAAU,CAACmC,QAAZ,CAAL,CACVC,IADU,CACL,CADK,EAEVC,GAFU,CAEN,UAAUC,CAAV,EAAaC,SAAb,EAAwB;AAC7B,aAAOvC,UAAU,CACZwC,OADE,CACMD,SAAS,GAAG,CADlB,EAEFE,IAFE,CAEG,UAAUC,IAAV,EAAgB;AACtB,eAAOA,IAAI,CAACC,cAAL,EAAP;AACH,OAJM,EAKFF,IALE,CAKG,UAAUG,OAAV,EAAmB;AACzB,YAAIC,WAAW,GAAGD,OAAO,CAACE,KAAR,CAAcT,GAAd,CAAkB,UAAUU,IAAV,EAAgB;AAAE,iBAAOA,IAAI,CAACC,GAAL,IAAY,EAAnB;AAAwB,SAA5D,EAA8DC,IAA9D,CAAmE,EAAnE,CAAlB;AACA,eAAOjB,OAAO,CAACC,OAAR,CAAgB;AACnBY,UAAAA,WAAW,EAAEA,WADM;AAEnBN,UAAAA,SAAS,EAAEA;AAFQ,SAAhB,CAAP;AAIH,OAXM,CAAP;AAYH,KAfc,CAAf;AAgBA,WAAOP,OAAO,CAACkB,GAAR,CAAYhB,QAAZ,EAAsBO,IAAtB,CAA2B,UAAUU,IAAV,EAAgB;AAC9CA,MAAAA,IAAI,CAACC,IAAL,CAAU,UAAUC,CAAV,EAAaC,CAAb,EAAgB;AAAE,eAAOD,CAAC,CAACd,SAAF,GAAce,CAAC,CAACf,SAAvB;AAAmC,OAA/D;AACA,aAAOP,OAAO,CAACC,OAAR,CAAgBkB,IAAI,CAACd,GAAL,CAAS,UAAUU,IAAV,EAAgB;AAAE,eAAOA,IAAI,CAACF,WAAZ;AAA0B,OAArD,CAAhB,CAAP;AACH,KAHM,CAAP;AAIH,GAxBD;;AAyBA,MAAIrB,WAAW,GAAG,UAAU+B,KAAV,EAAiB;AAC/B,QAAIC,UAAU,GAAGjE,KAAK,CAAC1C,GAAN,CAAU,YAAV,CAAjB;;AACA,QAAI2G,UAAJ,EAAgB;AACZA,MAAAA,UAAU,CAACD,KAAK,CAAChB,SAAP,CAAV;AACH;;AACDhD,IAAAA,KAAK,CAACqC,MAAN,CAAa,OAAb,EAAsB2B,KAAtB;AACH,GAND;;AAOA,MAAIE,gBAAgB,GAAG,UAAUvE,OAAV,EAAmB;AACtC,QAAIA,OAAO,YAAYL,MAAvB,EAA+B;AAC3B,aAAOK,OAAO,CAACF,MAAf;AACH;;AACD,QAAI,OAAOE,OAAP,KAAmB,QAAvB,EAAiC;AAC7B,aAAOA,OAAP;AACH;;AACD,WAAOA,OAAO,CAACA,OAAf;AACH,GARD;;AASA,MAAIiC,SAAS,GAAG,UAAUuC,YAAV,EAAwBC,cAAxB,EAAwCC,eAAxC,EAAyD;AACrE,QAAIxD,QAAQ,GAAGsD,YAAY,CAACrB,GAAb,CAAiB,UAAU3F,CAAV,EAAa;AAAE,aAAO2C,sBAAsB,CAAC3C,CAAD,EAAIiH,cAAJ,EAAoBC,eAApB,CAA7B;AAAoE,KAApG,CAAf;AACArE,IAAAA,KAAK,CAACqC,MAAN,CAAa,SAAb,EAAwBxB,QAAxB;AACAO,IAAAA,eAAe,CAAC,CAAD,CAAf;AACAH,IAAAA,QAAQ,CAAC,EAAD,CAAR;AACA,QAAIqD,OAAO,GAAG/C,YAAY,CAAClB,OAAb,CAAqB/B,MAArB,KAAgC,CAAhC,GACRkE,eAAe,GAAGU,IAAlB,CAAuB,UAAUqB,QAAV,EAAoB;AACzChD,MAAAA,YAAY,CAAClB,OAAb,GAAuBkE,QAAvB;AACA,aAAO9B,OAAO,CAACC,OAAR,CAAgB6B,QAAhB,CAAP;AACH,KAHC,CADQ,GAKR9B,OAAO,CAACC,OAAR,CAAgBnB,YAAY,CAAClB,OAA7B,CALN;AAMAiE,IAAAA,OAAO,CAACpB,IAAR,CAAa,UAAUqB,QAAV,EAAoB;AAC7B,UAAIC,GAAG,GAAG,EAAV;AACAD,MAAAA,QAAQ,CAACrH,OAAT,CAAiB,UAAUsG,IAAV,EAAgBR,SAAhB,EAA2B;AACxC,YAAIyB,UAAU,GAAG5D,QAAQ,CAACiC,GAAT,CAAa,UAAU3F,CAAV,EAAa;AAAE,iBAAO,CAACqG,IAAI,CAACQ,KAAL,CAAW7G,CAAX,KAAiB,EAAlB,EAAsBmB,MAA7B;AAAsC,SAAlE,EAAoEoG,MAApE,CAA2E,UAAUZ,CAAV,EAAaC,CAAb,EAAgB;AAAE,iBAAOD,CAAC,GAAGC,CAAX;AAAe,SAA5G,EAA8G,CAA9G,CAAjB;;AACA,aAAK,IAAIY,UAAU,GAAG,CAAtB,EAAyBA,UAAU,GAAGF,UAAtC,EAAkDE,UAAU,EAA5D,EAAgE;AAC5DH,UAAAA,GAAG,CAACI,IAAJ,CAAS;AACLD,YAAAA,UAAU,EAAEA,UADP;AAEL3B,YAAAA,SAAS,EAAEA;AAFN,WAAT;AAIH;AACJ,OARD;AASA/B,MAAAA,QAAQ,CAACuD,GAAD,CAAR;;AACA,UAAIA,GAAG,CAAClG,MAAJ,GAAa,CAAjB,EAAoB;AAChB8C,QAAAA,eAAe,CAAC,CAAD,CAAf;AACAa,QAAAA,WAAW,CAACuC,GAAG,CAAC,CAAD,CAAJ,CAAX;AACH;AACJ,KAhBD;AAiBH,GA5BD;;AA6BA/G,EAAAA,gBAAgB,CAAC6C,SAAjB,CAA2B,YAAY;AACnCiB,IAAAA,YAAY,CAAClB,OAAb,GAAuB,EAAvB;AACH,GAFD,EAEG,CAACI,UAAD,CAFH;AAGA,SAAO;AACH2B,IAAAA,YAAY,EAAEA,YADX;AAEHV,IAAAA,eAAe,EAAEA,eAFd;AAGHG,IAAAA,gBAAgB,EAAEA,gBAHf;AAIHV,IAAAA,YAAY,EAAEA,YAJX;AAKHe,IAAAA,eAAe,EAAEA,eALd;AAMHJ,IAAAA,mBAAmB,EAAEA,mBANlB;AAOHjB,IAAAA,QAAQ,EAAEA,QAPP;AAQHhB,IAAAA,SAAS,EAAEA,SARR;AASHgF,IAAAA,eAAe,EAAE7D,KAAK,CAAC1C,MATpB;AAUHoB,IAAAA,UAAU,EAAEA,UAVT;AAWH6C,IAAAA,MAAM,EAAEA,MAXL;AAYHX,IAAAA,SAAS,EAAEA,SAZR;AAaHd,IAAAA,WAAW,EAAEA,WAbV;AAcHnB,IAAAA,OAAO,EAAEkB,QAAQ,CAACvC,MAAT,KAAoB,CAApB,GAAwB,EAAxB,GAA6B4F,gBAAgB,CAACrD,QAAQ,CAAC,CAAD,CAAT,CAdnD;AAeHyB,IAAAA,UAAU,EAAEA;AAfT,GAAP;AAiBH,CA7ID;;AA+IA,IAAIwC,KAAK,GAAG,UAAUnE,EAAV,EAAc;AACtB,MAAIoE,QAAQ,GAAGpE,EAAE,CAACoE,QAAlB;AAAA,MAA4B/E,KAAK,GAAGW,EAAE,CAACX,KAAvC;AACA,MAAIgF,MAAM,GAAGtE,SAAS,CAACV,KAAD,CAAtB;AACA,SAAO+E,QAAQ,CAAC/G,QAAQ,CAAC,EAAD,EAAKgH,MAAL,CAAT,CAAf;AACH,CAJD;;AAKA,IAAIC,MAAM,GAAG,UAAUtE,EAAV,EAAc;AACvB,MAAIoE,QAAQ,GAAGpE,EAAE,CAACoE,QAAlB;AAAA,MAA4B/E,KAAK,GAAGW,EAAE,CAACX,KAAvC;AACA,MAAIS,UAAU,GAAGV,WAAW,CAACC,KAAD,CAAX,CAAmBS,UAApC;AACA,SAAOA,UAAU,GAAGhD,gBAAgB,CAACE,aAAjB,CAA+BmH,KAA/B,EAAsC;AAAE9E,IAAAA,KAAK,EAAEA;AAAT,GAAtC,EAAwD+E,QAAxD,CAAH,GAAuEtH,gBAAgB,CAACE,aAAjB,CAA+BF,gBAAgB,CAACyH,QAAhD,EAA0D,IAA1D,CAAxF;AACH,CAJD;;AAMA,IAAIC,eAAe,GAAG;AAAEC,EAAAA,IAAI,EAAE,CAAR;AAAWC,EAAAA,GAAG,EAAE;AAAhB,CAAtB;;AACA,IAAIC,aAAa,GAAG,UAAU3E,EAAV,EAAc;AAC9B,MAAIX,KAAK,GAAGW,EAAE,CAACX,KAAf;AAAA,MAAsBuF,QAAQ,GAAG5E,EAAE,CAAC4E,QAApC;AACA,MAAIC,IAAI,GAAG/H,gBAAgB,CAACgI,UAAjB,CAA4B9I,IAAI,CAAC+I,mBAAjC,CAAX;;AACA,MAAI3E,EAAE,GAAGL,SAAS,CAACV,KAAD,CAAlB;AAAA,MAA2BoC,YAAY,GAAGrB,EAAE,CAACqB,YAA7C;AAAA,MAA2DV,eAAe,GAAGX,EAAE,CAACW,eAAhF;AAAA,MAAiGG,gBAAgB,GAAGd,EAAE,CAACc,gBAAvH;AAAA,MAAyIV,YAAY,GAAGJ,EAAE,CAACI,YAA3J;AAAA,MAAyKe,eAAe,GAAGnB,EAAE,CAACmB,eAA9L;AAAA,MAA+MJ,mBAAmB,GAAGf,EAAE,CAACe,mBAAxO;AAAA,MAA6PnC,OAAO,GAAGoB,EAAE,CAACpB,OAA1Q;AAAA,MAAmRE,SAAS,GAAGkB,EAAE,CAAClB,SAAlS;AAAA,MAA6SgF,eAAe,GAAG9D,EAAE,CAAC8D,eAAlU;AAAA,MAAmVnF,UAAU,GAAGqB,EAAE,CAACrB,UAAnW;AAAA,MAA+W6C,MAAM,GAAGxB,EAAE,CAACwB,MAA3X;AAAA,MAAmYD,UAAU,GAAGvB,EAAE,CAACuB,UAAnZ;;AACA,MAAIqD,eAAe,GAAG,UAAU9I,CAAV,EAAa;AAC/B,QAAIA,CAAC,CAAC+I,OAAF,KAAc,EAAd,IAAoB,CAACjG,OAAzB,EAAkC;AAC9B;AACH;;AACD4C,IAAAA,MAAM;AACT,GALD;;AAMA,MAAIsD,iBAAiB,GAAG,UAAUhJ,CAAV,EAAa;AACjC6E,IAAAA,eAAe,CAAC7E,CAAC,CAACiJ,MAAF,CAASC,OAAV,CAAf;AACH,GAFD;;AAGA,MAAIC,kBAAkB,GAAG,UAAUnJ,CAAV,EAAa;AAClCgF,IAAAA,gBAAgB,CAAChF,CAAC,CAACiJ,MAAF,CAASC,OAAV,CAAhB;AACH,GAFD;;AAGA,MAAIE,OAAO,GAAG,YAAY;AACtBV,IAAAA,QAAQ;AACRnD,IAAAA,YAAY;AACf,GAHD;;AAIA,SAAQ3E,gBAAgB,CAACE,aAAjB,CAA+B,KAA/B,EAAsC;AAAEuI,IAAAA,SAAS,EAAE;AAAb,GAAtC,EACJzI,gBAAgB,CAACE,aAAjB,CAA+B,KAA/B,EAAsC;AAAEuI,IAAAA,SAAS,EAAE;AAAb,GAAtC,EACIzI,gBAAgB,CAACE,aAAjB,CAA+BhB,IAAI,CAACwJ,OAApC,EAA6C;AAAEC,IAAAA,WAAW,EAAGZ,IAAI,IAAIA,IAAI,CAACjD,MAAb,GAAsBiD,IAAI,CAACjD,MAAL,CAAY8D,aAAlC,GAAkD,iBAAlE;AAAsFC,IAAAA,IAAI,EAAE,MAA5F;AAAoG9J,IAAAA,KAAK,EAAEmD,OAA3G;AAAoH4G,IAAAA,QAAQ,EAAEjE,UAA9H;AAA0IkE,IAAAA,SAAS,EAAEb;AAArJ,GAA7C,CADJ,EAEIlI,gBAAgB,CAACE,aAAjB,CAA+B,KAA/B,EAAsC;AAAEuI,IAAAA,SAAS,EAAE;AAAb,GAAtC,EACI/E,YADJ,EAEI,GAFJ,EAGI0D,eAHJ,CAFJ,CADI,EAOJpH,gBAAgB,CAACE,aAAjB,CAA+B,OAA/B,EAAwC;AAAEuI,IAAAA,SAAS,EAAE;AAAb,GAAxC,EACIzI,gBAAgB,CAACE,aAAjB,CAA+B,OAA/B,EAAwC;AAAEuI,IAAAA,SAAS,EAAE,oCAAb;AAAmDH,IAAAA,OAAO,EAAElG,SAA5D;AAAuEyG,IAAAA,IAAI,EAAE,UAA7E;AAAyFC,IAAAA,QAAQ,EAAEV;AAAnG,GAAxC,CADJ,EAEI,GAFJ,EAGIL,IAAI,IAAIA,IAAI,CAACjD,MAAb,GAAsBiD,IAAI,CAACjD,MAAL,CAAY1C,SAAlC,GAA8C,YAHlD,CAPI,EAWJpC,gBAAgB,CAACE,aAAjB,CAA+B,OAA/B,EAAwC;AAAEuI,IAAAA,SAAS,EAAE;AAAb,GAAxC,EACIzI,gBAAgB,CAACE,aAAjB,CAA+B,OAA/B,EAAwC;AAAEuI,IAAAA,SAAS,EAAE,oCAAb;AAAmDH,IAAAA,OAAO,EAAErG,UAA5D;AAAwE4G,IAAAA,IAAI,EAAE,UAA9E;AAA0FC,IAAAA,QAAQ,EAAEP;AAApG,GAAxC,CADJ,EAEI,GAFJ,EAGIR,IAAI,IAAIA,IAAI,CAACjD,MAAb,GAAsBiD,IAAI,CAACjD,MAAL,CAAY7C,UAAlC,GAA+C,aAHnD,CAXI,EAeJjC,gBAAgB,CAACE,aAAjB,CAA+B,KAA/B,EAAsC;AAAEuI,IAAAA,SAAS,EAAE;AAAb,GAAtC,EACIzI,gBAAgB,CAACE,aAAjB,CAA+B,KAA/B,EAAsC;AAAEuI,IAAAA,SAAS,EAAE;AAAb,GAAtC,EACIzI,gBAAgB,CAACE,aAAjB,CAA+BhB,IAAI,CAAC8J,OAApC,EAA6C;AAAEC,IAAAA,QAAQ,EAAE/J,IAAI,CAACgK,QAAL,CAAcC,YAA1B;AAAwCd,IAAAA,MAAM,EAAErI,gBAAgB,CAACE,aAAjB,CAA+BhB,IAAI,CAACkK,aAApC,EAAmD;AAAEC,MAAAA,OAAO,EAAEhF;AAAX,KAAnD,EACrFrE,gBAAgB,CAACE,aAAjB,CAA+BG,YAA/B,EAA6C,IAA7C,CADqF,CAAhD;AACgBuF,IAAAA,OAAO,EAAE,YAAY;AAAE,aAAQmC,IAAI,IAAIA,IAAI,CAACjD,MAAb,GAAsBiD,IAAI,CAACjD,MAAL,CAAYwE,aAAlC,GAAkD,gBAA1D;AAA8E,KADrH;AACuHC,IAAAA,MAAM,EAAE7B;AAD/H,GAA7C,CADJ,CADJ,EAII1H,gBAAgB,CAACE,aAAjB,CAA+B,KAA/B,EAAsC;AAAEuI,IAAAA,SAAS,EAAE;AAAb,GAAtC,EACIzI,gBAAgB,CAACE,aAAjB,CAA+BhB,IAAI,CAAC8J,OAApC,EAA6C;AAAEC,IAAAA,QAAQ,EAAE/J,IAAI,CAACgK,QAAL,CAAcC,YAA1B;AAAwCd,IAAAA,MAAM,EAAErI,gBAAgB,CAACE,aAAjB,CAA+BhB,IAAI,CAACkK,aAApC,EAAmD;AAAEC,MAAAA,OAAO,EAAE5E;AAAX,KAAnD,EACrFzE,gBAAgB,CAACE,aAAjB,CAA+BD,QAA/B,EAAyC,IAAzC,CADqF,CAAhD;AACY2F,IAAAA,OAAO,EAAE,YAAY;AAAE,aAAQmC,IAAI,IAAIA,IAAI,CAACjD,MAAb,GAAsBiD,IAAI,CAACjD,MAAL,CAAY0E,SAAlC,GAA8C,YAAtD;AAAsE,KADzG;AAC2GD,IAAAA,MAAM,EAAE7B;AADnH,GAA7C,CADJ,CAJJ,EAOI1H,gBAAgB,CAACE,aAAjB,CAA+B,KAA/B,EAAsC;AAAEuI,IAAAA,SAAS,EAAE;AAAb,GAAtC,EACIzI,gBAAgB,CAACE,aAAjB,CAA+BhB,IAAI,CAACuK,MAApC,EAA4C;AAAEJ,IAAAA,OAAO,EAAEb;AAAX,GAA5C,EAAkET,IAAI,IAAIA,IAAI,CAACjD,MAAb,GAAsBiD,IAAI,CAACjD,MAAL,CAAY4E,KAAlC,GAA0C,OAA5G,CADJ,CAPJ,CAfI,CAAR;AAwBH,CA5CD;;AA8CA,IAAIC,0BAA0B,GAAG,UAAUzG,EAAV,EAAc;AAC3C,MAAIoE,QAAQ,GAAGpE,EAAE,CAACoE,QAAlB;AAAA,MAA4B+B,OAAO,GAAGnG,EAAE,CAACmG,OAAzC;AACA,MAAItB,IAAI,GAAG/H,gBAAgB,CAACgI,UAAjB,CAA4B9I,IAAI,CAAC+I,mBAAjC,CAAX;AACA,MAAI2B,KAAK,GAAI7B,IAAI,IAAIA,IAAI,CAACjD,MAAb,GAAsBiD,IAAI,CAACjD,MAAL,CAAYA,MAAlC,GAA2C,QAAxD;AACA,MAAI+E,IAAI,GAAG7J,gBAAgB,CAACE,aAAjB,CAA+BI,UAA/B,EAA2C,IAA3C,CAAX;AACA,SAAOgH,QAAQ,CAAC;AAAEuC,IAAAA,IAAI,EAAEA,IAAR;AAAcD,IAAAA,KAAK,EAAEA,KAArB;AAA4BP,IAAAA,OAAO,EAAEA;AAArC,GAAD,CAAf;AACH,CAND;;AAQA,IAAIS,cAAc,GAAG;AAAEnC,EAAAA,IAAI,EAAE,CAAR;AAAWC,EAAAA,GAAG,EAAE;AAAhB,CAArB;;AACA,IAAImC,uBAAuB,GAAG,UAAU7G,EAAV,EAAc;AACxC,MAAImG,OAAO,GAAGnG,EAAE,CAACmG,OAAjB;AACA,SAAQrJ,gBAAgB,CAACE,aAAjB,CAA+ByJ,0BAA/B,EAA2D;AAAEN,IAAAA,OAAO,EAAEA;AAAX,GAA3D,EAAiF,UAAUvI,CAAV,EAAa;AAAE,WAAQd,gBAAgB,CAACE,aAAjB,CAA+BhB,IAAI,CAAC8J,OAApC,EAA6C;AAAEC,MAAAA,QAAQ,EAAE/J,IAAI,CAACgK,QAAL,CAAcC,YAA1B;AAAwCd,MAAAA,MAAM,EAAErI,gBAAgB,CAACE,aAAjB,CAA+BhB,IAAI,CAACkK,aAApC,EAAmD;AAAEC,QAAAA,OAAO,EAAEA;AAAX,OAAnD,EAAyEvI,CAAC,CAAC+I,IAA3E,CAAhD;AAAkIjE,MAAAA,OAAO,EAAE,YAAY;AAAE,eAAO9E,CAAC,CAAC8I,KAAT;AAAiB,OAA1K;AAA4KL,MAAAA,MAAM,EAAEO;AAApL,KAA7C,CAAR;AAA8P,GAA9V,CAAR;AACH,CAHD;;AAKA,IAAIE,aAAa,GAAG;AAAErC,EAAAA,IAAI,EAAE,CAAR;AAAWC,EAAAA,GAAG,EAAE;AAAhB,CAApB;;AACA,IAAIqC,iBAAiB,GAAG,UAAU/G,EAAV,EAAc;AAClC,MAAIoE,QAAQ,GAAGpE,EAAE,CAACoE,QAAlB;AAAA,MAA4B/E,KAAK,GAAGW,EAAE,CAACX,KAAvC;AACA,MAAIS,UAAU,GAAGV,WAAW,CAACC,KAAD,CAAX,CAAmBS,UAApC;;AACA,MAAIkH,eAAe,GAAG,UAAUC,KAAV,EAAiB;AAAE,WAAOnK,gBAAgB,CAACE,aAAjB,CAA+B6J,uBAA/B,EAAwDxJ,QAAQ,CAAC,EAAD,EAAK4J,KAAL,CAAhE,CAAP;AAAsF,GAA/H;;AACA,MAAIC,MAAM,GAAG9C,QAAQ,IAAI4C,eAAzB;AACA,SAAOlH,UAAU,GAAIhD,gBAAgB,CAACE,aAAjB,CAA+BhB,IAAI,CAACmL,OAApC,EAA6C;AAAEpB,IAAAA,QAAQ,EAAE/J,IAAI,CAACgK,QAAL,CAAcoB,UAA1B;AAAsCjC,IAAAA,MAAM,EAAE,UAAUkC,MAAV,EAAkB;AAC1H,aAAOH,MAAM,CAAC;AACVf,QAAAA,OAAO,EAAEkB;AADC,OAAD,CAAb;AAGH,KAJ6D;AAI3D3E,IAAAA,OAAO,EAAE,UAAU2E,MAAV,EAAkB;AAAE,aAAOvK,gBAAgB,CAACE,aAAjB,CAA+B2H,aAA/B,EAA8C;AAAEtF,QAAAA,KAAK,EAAEA,KAAT;AAAgBuF,QAAAA,QAAQ,EAAEyC;AAA1B,OAA9C,CAAP;AAA2F,KAJ7D;AAI+DhB,IAAAA,MAAM,EAAES,aAJvE;AAIsFQ,IAAAA,mBAAmB,EAAE,KAJ3G;AAIkHC,IAAAA,aAAa,EAAE;AAJjI,GAA7C,CAAJ,GAI8LzK,gBAAgB,CAACE,aAAjB,CAA+BF,gBAAgB,CAACyH,QAAhD,EAA0D,IAA1D,CAJ/M;AAKH,CAVD;;AAYA,IAAIiD,eAAe,GAAG,UAAUpD,QAAV,EAAoBqD,MAApB,EAA4B;AAC9C,MAAI/C,GAAG,GAAGN,QAAQ,CAACsD,SAAnB;AACA,MAAIjD,IAAI,GAAGL,QAAQ,CAACuD,UAApB;AACA,MAAI/J,CAAC,GAAGwG,QAAQ,CAACwD,aAAjB;;AACA,SAAOhK,CAAC,IAAIA,CAAC,KAAK6J,MAAlB,EAA0B;AACtB/C,IAAAA,GAAG,IAAI9G,CAAC,CAAC8J,SAAT;AACAjD,IAAAA,IAAI,IAAI7G,CAAC,CAAC+J,UAAV;AACA/J,IAAAA,CAAC,GAAGA,CAAC,CAACgK,aAAN;AACH;;AACD,SAAO;AACHnD,IAAAA,IAAI,EAAEA,IADH;AAEHC,IAAAA,GAAG,EAAEA;AAFF,GAAP;AAIH,CAbD;;AAeA,IAAImD,UAAU,GAAG,UAAUC,GAAV,EAAe;AAC5B,MAAIL,MAAM,GAAGK,GAAG,CAACC,UAAjB;;AACA,MAAIN,MAAJ,EAAY;AACRA,IAAAA,MAAM,CAACO,WAAP,CAAmBF,GAAnB;AACH;AACJ,CALD;;AAMA,IAAIG,WAAW,GAAG,UAAUC,eAAV,EAA2BC,IAA3B,EAAiC;AAC/CN,EAAAA,UAAU,CAACK,eAAD,CAAV;AACA,MAAIT,MAAM,GAAGU,IAAI,CAACJ,UAAlB;;AACA,MAAIN,MAAJ,EAAY;AACRA,IAAAA,MAAM,CAACW,YAAP,CAAoBF,eAApB,EAAqCC,IAArC;AACH;;AACDN,EAAAA,UAAU,CAACM,IAAD,CAAV;AACH,CAPD;;AAQA,IAAIE,MAAM,GAAG,UAAUP,GAAV,EAAe;AACxB,MAAIL,MAAM,GAAGK,GAAG,CAACC,UAAjB;;AACA,MAAI,CAACN,MAAL,EAAa;AACT;AACH;;AACD,MAAIa,KAAK,GAAGC,QAAQ,CAACC,WAAT,EAAZ;AACAF,EAAAA,KAAK,CAACG,kBAAN,CAAyBX,GAAzB;AACAG,EAAAA,WAAW,CAACK,KAAK,CAACI,eAAN,EAAD,EAA0BZ,GAA1B,CAAX;AACAL,EAAAA,MAAM,CAACkB,SAAP;AACH,CATD;;AAWA,IAAIC,OAAO,GAAG,UAAU5I,EAAV,EAAc;AACxB,MAAIqC,SAAS,GAAGrC,EAAE,CAACqC,SAAnB;AAAA,MAA8BhD,KAAK,GAAGW,EAAE,CAACX,KAAzC;AAAA,MAAgDwJ,kBAAkB,GAAG7I,EAAE,CAAC6I,kBAAxE;;AACA,MAAIzI,EAAE,GAAGtD,gBAAgB,CAACmD,QAAjB,CAA0B;AAC/B+D,IAAAA,UAAU,EAAE,CAAC,CADkB;AAE/B3B,IAAAA,SAAS,EAAE,CAAC;AAFmB,GAA1B,CAAT;AAAA,MAGIgB,KAAK,GAAGjD,EAAE,CAAC,CAAD,CAHd;AAAA,MAGmB0I,QAAQ,GAAG1I,EAAE,CAAC,CAAD,CAHhC;;AAIA,MAAIG,EAAE,GAAGzD,gBAAgB,CAACmD,QAAjB,CAA0B,CAACvB,oBAAD,CAA1B,CAAT;AAAA,MAA4DqK,aAAa,GAAGxI,EAAE,CAAC,CAAD,CAA9E;AAAA,MAAmFyI,gBAAgB,GAAGzI,EAAE,CAAC,CAAD,CAAxG;;AACA,MAAIG,EAAE,GAAG5D,gBAAgB,CAACmD,QAAjB,CAA0B;AAC/BoC,IAAAA,SAAS,EAAEA,SADoB;AAE/B4G,IAAAA,KAAK,EAAE,CAFwB;AAG/BC,IAAAA,MAAM,EAAElN,IAAI,CAACmN,iBAAL,CAAuBC;AAHA,GAA1B,CAAT;AAAA,MAIIC,YAAY,GAAG3I,EAAE,CAAC,CAAD,CAJrB;AAAA,MAI0B4I,eAAe,GAAG5I,EAAE,CAAC,CAAD,CAJ9C;;AAKA,MAAI6I,eAAe,GAAGzM,gBAAgB,CAACyC,MAAjB,CAAwB,IAAxB,CAAtB;AACA,MAAIiK,mBAAmB,GAAG1M,gBAAgB,CAACyC,MAAjB,CAAwB,EAAxB,CAA1B;;AACA,MAAIkK,cAAc,GAAG,UAAUC,YAAV,EAAwB;AACzC,QAAIC,cAAc,GAAGD,YAAY,CAACE,gBAAb,CAA8B,4BAA9B,CAArB;AACA,QAAIC,KAAK,GAAGF,cAAc,CAAChM,MAA3B;;AACA,SAAK,IAAIF,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGoM,KAApB,EAA2BpM,CAAC,EAA5B,EAAgC;AAC5BkM,MAAAA,cAAc,CAAClM,CAAD,CAAd,CAAkBmK,aAAlB,CAAgCI,WAAhC,CAA4C2B,cAAc,CAAClM,CAAD,CAA1D;AACH;AACJ,GAND;;AAOA,MAAIqM,SAAS,GAAG,UAAU9K,OAAV,EAAmB0K,YAAnB,EAAiCK,IAAjC,EAAuCC,aAAvC,EAAsD;AAClE,QAAI1B,KAAK,GAAGC,QAAQ,CAACC,WAAT,EAAZ;AACA,QAAIyB,UAAU,GAAGF,IAAI,CAACE,UAAtB;;AACA,QAAI,CAACA,UAAL,EAAiB;AACb;AACH;;AACD,QAAIC,WAAW,GAAGF,aAAa,CAAC,CAAD,CAAb,CAAiBG,eAAnC;AACA,QAAIC,SAAS,GAAGJ,aAAa,CAACrM,MAAd,KAAyB,CAAzB,GAA6BuM,WAA7B,GAA2CF,aAAa,CAACA,aAAa,CAACrM,MAAd,GAAuB,CAAxB,CAAb,CAAwCwM,eAAnG;AACA7B,IAAAA,KAAK,CAAC+B,QAAN,CAAeJ,UAAf,EAA2BC,WAA3B;AACA5B,IAAAA,KAAK,CAACgC,MAAN,CAAaL,UAAb,EAAyBG,SAAS,GAAG,CAArC;AACA,QAAIG,OAAO,GAAGhC,QAAQ,CAACvL,aAAT,CAAuB,MAAvB,CAAd;AACAsL,IAAAA,KAAK,CAACkC,gBAAN,CAAuBD,OAAvB;AACA,QAAIE,WAAW,GAAGF,OAAO,CAACG,qBAAR,EAAlB;AACA,QAAIC,aAAa,GAAGjB,YAAY,CAACgB,qBAAb,EAApB;AACA,QAAIE,YAAY,GAAGrC,QAAQ,CAACvL,aAAT,CAAuB,MAAvB,CAAnB;AACA0M,IAAAA,YAAY,CAACmB,WAAb,CAAyBD,YAAzB;AACAA,IAAAA,YAAY,CAACE,KAAb,CAAmBrG,IAAnB,GAA2B,OAAOgG,WAAW,CAAChG,IAAZ,GAAmBkG,aAAa,CAAClG,IAAxC,CAAD,GAAkDkG,aAAa,CAACI,KAAhE,GAAwE,GAAlG;AACAH,IAAAA,YAAY,CAACE,KAAb,CAAmBpG,GAAnB,GAA0B,OAAO+F,WAAW,CAAC/F,GAAZ,GAAkBiG,aAAa,CAACjG,GAAvC,CAAD,GAAgDiG,aAAa,CAACK,MAA9D,GAAuE,GAAhG;AACAJ,IAAAA,YAAY,CAACE,KAAb,CAAmBC,KAAnB,GAA4B,MAAMN,WAAW,CAACM,KAAnB,GAA4BJ,aAAa,CAACI,KAA1C,GAAkD,GAA7E;AACAH,IAAAA,YAAY,CAACE,KAAb,CAAmBE,MAAnB,GAA6B,MAAMP,WAAW,CAACO,MAAnB,GAA6BL,aAAa,CAACK,MAA3C,GAAoD,GAAhF;AACAJ,IAAAA,YAAY,CAACK,SAAb,CAAuBC,GAAvB,CAA2B,uBAA3B;AACAN,IAAAA,YAAY,CAACO,YAAb,CAA0B,OAA1B,EAAmCnM,OAAO,CAACF,MAAR,CAAesM,IAAf,EAAnC;AACA/C,IAAAA,MAAM,CAACkC,OAAD,CAAN;;AACA,QAAI1B,kBAAJ,EAAwB;AACpBA,MAAAA,kBAAkB,CAAC;AACf+B,QAAAA,YAAY,EAAEA,YADC;AAEf5L,QAAAA,OAAO,EAAEA;AAFM,OAAD,CAAlB;AAIH;AACJ,GA7BD;;AA8BA,MAAIqM,YAAY,GAAG,UAAU3B,YAAV,EAAwB;AACvC,QAAI4B,WAAW,GAAG9B,mBAAmB,CAAC9J,OAAtC;;AACA,QAAI4L,WAAW,CAAC3N,MAAZ,KAAuB,CAA3B,EAA8B;AAC1B;AACH;;AACD,QAAI4N,KAAK,GAAG,GAAG/M,KAAH,CAAST,IAAT,CAAc2L,YAAY,CAACE,gBAAb,CAA8B,4BAA9B,CAAd,CAAZ;AACA,QAAI4B,QAAQ,GAAGF,WAAW,CAACnJ,GAAZ,CAAgB,UAAUU,IAAV,EAAgB;AAAE,aAAOA,IAAI,CAAC4I,IAAZ;AAAmB,KAArD,EAAuD1I,IAAvD,CAA4D,EAA5D,CAAf;AACAgG,IAAAA,aAAa,CAACxM,OAAd,CAAsB,UAAUyC,OAAV,EAAmB;AACrC,UAAI0M,UAAU,GAAG1M,OAAO,CAACF,MAAzB;;AACA,UAAI,CAAC4M,UAAU,CAACN,IAAX,EAAL,EAAwB;AACpB;AACH;;AACD,UAAIO,YAAY,GAAG3M,OAAO,CAACC,KAAR,CAAc2M,OAAd,CAAsB,GAAtB,MAA+B,CAAC,CAAhC,GAAoC,IAAIjN,MAAJ,CAAWK,OAAX,EAAoBA,OAAO,CAACC,KAAR,GAAgB,GAApC,CAApC,GAA+ED,OAAlG;AACA,UAAIqE,KAAJ;AACA,UAAIwI,OAAO,GAAG,EAAd;;AACA,aAAO,CAACxI,KAAK,GAAGsI,YAAY,CAACG,IAAb,CAAkBN,QAAlB,CAAT,MAA0C,IAAjD,EAAuD;AACnDK,QAAAA,OAAO,CAAC5H,IAAR,CAAa;AACTjF,UAAAA,OAAO,EAAE2M,YADA;AAETI,UAAAA,UAAU,EAAE1I,KAAK,CAAC2I,KAFT;AAGTC,UAAAA,QAAQ,EAAEN,YAAY,CAACO;AAHd,SAAb;AAKH;;AACDL,MAAAA,OAAO,CACF1J,GADL,CACS,UAAUU,IAAV,EAAgB;AAAE,eAAQ;AAC/B7D,UAAAA,OAAO,EAAE6D,IAAI,CAAC7D,OADiB;AAE/BmN,UAAAA,OAAO,EAAEb,WAAW,CAAC9M,KAAZ,CAAkBqE,IAAI,CAACkJ,UAAvB,EAAmClJ,IAAI,CAACoJ,QAAxC;AAFsB,SAAR;AAGtB,OAJL,EAKK1P,OALL,CAKa,UAAUsG,IAAV,EAAgB;AACzB,YAAIuJ,WAAW,GAAGvJ,IAAI,CAACsJ,OAAL,CAAapI,MAAb,CAAoB,UAAUsI,GAAV,EAAexJ,IAAf,EAAqB;AACvDwJ,UAAAA,GAAG,CAACxJ,IAAI,CAACyJ,SAAN,CAAH,GAAsBrO,aAAa,CAACA,aAAa,CAAC,EAAD,EAAMoO,GAAG,CAACxJ,IAAI,CAACyJ,SAAN,CAAH,IAAuB,EAA7B,CAAd,EAAiD,CAACzJ,IAAD,CAAjD,CAAnC;AACA,iBAAOwJ,GAAP;AACH,SAHiB,EAGf,EAHe,CAAlB;AAIA3Q,QAAAA,MAAM,CAAC6Q,MAAP,CAAcH,WAAd,EAA2B7P,OAA3B,CAAmC,UAAUyN,aAAV,EAAyB;AACxDF,UAAAA,SAAS,CAACjH,IAAI,CAAC7D,OAAN,EAAe0K,YAAf,EAA6B6B,KAAK,CAACvB,aAAa,CAAC,CAAD,CAAb,CAAiBsC,SAAlB,CAAlC,EAAgEtC,aAAhE,CAAT;AACH,SAFD;AAGH,OAbD;AAcH,KA7BD;AA8BH,GArCD;;AAsCA,MAAIwC,oBAAoB,GAAG,UAAUxN,OAAV,EAAmB;AAC1C,QAAIA,OAAO,IAAIA,OAAO,CAACrB,MAAR,GAAiB,CAAhC,EAAmC;AAC/BqL,MAAAA,gBAAgB,CAAChK,OAAD,CAAhB;AACH;AACJ,GAJD;;AAKA,MAAIyN,kBAAkB,GAAG,UAAUjM,YAAV,EAAwB;AAC7CsI,IAAAA,QAAQ,CAACtI,YAAD,CAAR;AACH,GAFD;;AAGA,MAAIkM,yBAAyB,GAAG,UAAUxD,MAAV,EAAkB;AAC9C,QAAI,CAACA,MAAM,CAACyD,GAAP,CAAWtK,SAAX,CAAL,EAA4B;AACxB;AACH;;AACD,QAAIuK,aAAa,GAAG1D,MAAM,CAACvM,GAAP,CAAW0F,SAAX,CAApB;;AACA,QAAIuK,aAAJ,EAAmB;AACftD,MAAAA,eAAe,CAAC;AACZxB,QAAAA,GAAG,EAAE8E,aAAa,CAAC9E,GADP;AAEZzF,QAAAA,SAAS,EAAEA,SAFC;AAGZ4G,QAAAA,KAAK,EAAE2D,aAAa,CAAC3D,KAHT;AAIZC,QAAAA,MAAM,EAAE0D,aAAa,CAAC1D;AAJV,OAAD,CAAf;AAMH;AACJ,GAbD;;AAcA,MAAI2D,cAAc,GAAG,YAAY;AAC7B,WAAO9D,aAAa,CAACpL,MAAd,KAAyB,CAAzB,IAA+BoL,aAAa,CAACpL,MAAd,KAAyB,CAAzB,IAA8BoL,aAAa,CAAC,CAAD,CAAb,CAAiBjK,MAAjB,CAAwBsM,IAAxB,OAAmC,EAAvG;AACH,GAFD;;AAGAtO,EAAAA,gBAAgB,CAAC6C,SAAjB,CAA2B,YAAY;AACnC,QAAIkN,cAAc,MACdxD,YAAY,CAACH,MAAb,KAAwBlN,IAAI,CAACmN,iBAAL,CAAuB2D,SAD/C,IAEAtD,mBAAmB,CAAC9J,OAApB,CAA4B/B,MAFhC,EAEwC;AACpC;AACH;;AACD,QAAI+L,YAAY,GAAGL,YAAY,CAACvB,GAAhC;AACA,QAAIyD,KAAK,GAAG,GAAG/M,KAAH,CAAST,IAAT,CAAc2L,YAAY,CAACE,gBAAb,CAA8B,4BAA9B,CAAd,CAAZ;AACA,QAAI0B,WAAW,GAAGC,KAAK,CAClBpJ,GADa,CACT,UAAU4H,IAAV,EAAgB;AAAE,aAAOA,IAAI,CAACgD,WAAZ;AAA0B,KADnC,EAEbhJ,MAFa,CAEN,UAAU3C,IAAV,EAAgB4L,IAAhB,EAAsBhB,KAAtB,EAA6B;AACrC,aAAO5K,IAAI,CAAC3C,MAAL,CAAYuO,IAAI,CAACC,KAAL,CAAW,EAAX,EAAe9K,GAAf,CAAmB,UAAU+K,CAAV,EAAazP,CAAb,EAAgB;AAAE,eAAQ;AAC5DgO,UAAAA,IAAI,EAAEyB,CADsD;AAE5D/C,UAAAA,eAAe,EAAE1M,CAF2C;AAG5D6O,UAAAA,SAAS,EAAEN;AAHiD,SAAR;AAInD,OAJc,CAAZ,CAAP;AAKH,KARiB,EAQf,CACC;AACIP,MAAAA,IAAI,EAAE,EADV;AAEItB,MAAAA,eAAe,EAAE,CAFrB;AAGImC,MAAAA,SAAS,EAAE;AAHf,KADD,CARe,EAeb9N,KAfa,CAeP,CAfO,CAAlB;AAgBAgL,IAAAA,mBAAmB,CAAC9J,OAApB,GAA8B4L,WAA9B;AACH,GAzBD,EAyBG,CAACvC,aAAD,EAAgBM,YAAY,CAACH,MAA7B,CAzBH;AA0BApM,EAAAA,gBAAgB,CAAC6C,SAAjB,CAA2B,YAAY;AACnC,QAAIkN,cAAc,MAAM,CAACxD,YAAY,CAACvB,GAAlC,IAAyCuB,YAAY,CAACH,MAAb,KAAwBlN,IAAI,CAACmN,iBAAL,CAAuB2D,SAA5F,EAAuG;AACnG;AACH;;AACD,QAAIpD,YAAY,GAAGL,YAAY,CAACvB,GAAhC;AACA2B,IAAAA,cAAc,CAACC,YAAD,CAAd;AACA2B,IAAAA,YAAY,CAAC3B,YAAD,CAAZ;AACAyD,IAAAA,aAAa;AAChB,GARD,EAQG,CAACpE,aAAD,EAAgB1F,KAAhB,EAAuBgG,YAAY,CAACH,MAApC,EAA4CM,mBAAmB,CAAC9J,OAAhE,CARH;AASA5C,EAAAA,gBAAgB,CAAC6C,SAAjB,CAA2B,YAAY;AACnC,QAAIkN,cAAc,MAAMxD,YAAY,CAACvB,GAAjC,IAAwCuB,YAAY,CAACH,MAAb,KAAwBlN,IAAI,CAACmN,iBAAL,CAAuB2D,SAA3F,EAAsG;AAClGrD,MAAAA,cAAc,CAACJ,YAAY,CAACvB,GAAd,CAAd;AACH;AACJ,GAJD,EAIG,CAACiB,aAAD,EAAgBM,YAAY,CAACH,MAA7B,CAJH;;AAKA,MAAIiE,aAAa,GAAG,YAAY;AAC5B,QAAI9J,KAAK,CAAChB,SAAN,KAAoBA,SAApB,IAAiC,CAACgH,YAAY,CAACvB,GAA/C,IAAsDuB,YAAY,CAACH,MAAb,KAAwBlN,IAAI,CAACmN,iBAAL,CAAuB2D,SAAzG,EAAoH;AAChH;AACH;;AACD,QAAIM,SAAS,GAAG/D,YAAY,CAACvB,GAA7B;AACA,QAAIyD,KAAK,GAAG6B,SAAS,CAACxD,gBAAV,CAA2B,wBAA3B,CAAZ;;AACA,QAAIvG,KAAK,CAACW,UAAN,GAAmBuH,KAAK,CAAC5N,MAA7B,EAAqC;AACjC,UAAIoM,IAAI,GAAGwB,KAAK,CAAClI,KAAK,CAACW,UAAP,CAAhB;;AACA,UAAIhE,EAAE,GAAGwH,eAAe,CAACuC,IAAD,EAAOqD,SAAP,CAAxB;AAAA,UAA2C3I,IAAI,GAAGzE,EAAE,CAACyE,IAArD;AAAA,UAA2D4I,KAAK,GAAGrN,EAAE,CAAC0E,GAAtE;;AACA,UAAI4I,IAAI,GAAGjO,KAAK,CAAC1C,GAAN,CAAU,mBAAV,CAAX;;AACA,UAAI2Q,IAAJ,EAAU;AACNA,QAAAA,IAAI,CAACjL,SAAD,EAAY,CAAC+K,SAAS,CAAC1C,qBAAV,GAAkCM,MAAlC,GAA2CqC,KAA5C,IAAqDhE,YAAY,CAACJ,KAA9E,EAAqFxE,IAAI,GAAG4E,YAAY,CAACJ,KAAzG,EAAgHI,YAAY,CAACJ,KAA7H,CAAJ;;AACA,YAAIM,eAAe,CAAC7J,OAApB,EAA6B;AACzB6J,UAAAA,eAAe,CAAC7J,OAAhB,CAAwBuL,SAAxB,CAAkCsC,MAAlC,CAAyC,gCAAzC;AACH;;AACDhE,QAAAA,eAAe,CAAC7J,OAAhB,GAA0BqK,IAA1B;AACAA,QAAAA,IAAI,CAACkB,SAAL,CAAeC,GAAf,CAAmB,gCAAnB;AACH;AACJ;AACJ,GAnBD;;AAoBApO,EAAAA,gBAAgB,CAAC6C,SAAjB,CAA2B,YAAY;AACnCN,IAAAA,KAAK,CAACO,SAAN,CAAgB,SAAhB,EAA2B4M,oBAA3B;AACAnN,IAAAA,KAAK,CAACO,SAAN,CAAgB,OAAhB,EAAyB6M,kBAAzB;AACApN,IAAAA,KAAK,CAACO,SAAN,CAAgB,cAAhB,EAAgC8M,yBAAhC;AACA,WAAO,YAAY;AACfrN,MAAAA,KAAK,CAACQ,WAAN,CAAkB,SAAlB,EAA6B2M,oBAA7B;AACAnN,MAAAA,KAAK,CAACQ,WAAN,CAAkB,OAAlB,EAA2B4M,kBAA3B;AACApN,MAAAA,KAAK,CAACQ,WAAN,CAAkB,cAAlB,EAAkC6M,yBAAlC;AACH,KAJD;AAKH,GATD,EASG,EATH;AAUA,SAAO5P,gBAAgB,CAACE,aAAjB,CAA+BF,gBAAgB,CAACyH,QAAhD,EAA0D,IAA1D,CAAP;AACH,CAzLD;;AA2LA,IAAIiJ,YAAY,GAAG,UAAUvG,KAAV,EAAiB;AAChC,MAAI4B,kBAAkB,GAAG/L,gBAAgB,CAAC2Q,OAAjB,CAAyB,YAAY;AAAE,WAAQxG,KAAK,IAAIA,KAAK,CAAC4B,kBAAf,GAAoC5B,KAAK,CAAC4B,kBAA1C,GAA+D,YAAY,CAAG,CAAtF;AAA0F,GAAjI,EAAmI,EAAnI,CAAzB;AACA,MAAIxJ,KAAK,GAAGvC,gBAAgB,CAAC2Q,OAAjB,CAAyB,YAAY;AAC7C,WAAOzR,IAAI,CAAC0R,WAAL,CAAiB;AACpBrE,MAAAA,YAAY,EAAE,IAAIsE,GAAJ;AADM,KAAjB,CAAP;AAGH,GAJW,EAIT,EAJS,CAAZ;;AAKA,MAAI3N,EAAE,GAAGD,SAAS,CAACV,KAAD,CAAlB;AAAA,MAA2BoC,YAAY,GAAGzB,EAAE,CAACyB,YAA7C;AAAA,MAA2DF,eAAe,GAAGvB,EAAE,CAACuB,eAAhF;AAAA,MAAiGJ,mBAAmB,GAAGnB,EAAE,CAACmB,mBAA1H;AAAA,MAA+IF,SAAS,GAAGjB,EAAE,CAACiB,SAA9J;AAAA,MAAyKd,WAAW,GAAGH,EAAE,CAACG,WAA1L;;AACA,MAAIyN,eAAe,GAAG,UAAU3G,KAAV,EAAiB;AAAE,WAAOnK,gBAAgB,CAACE,aAAjB,CAA+BsH,MAA/B,EAAuCjH,QAAQ,CAAC,EAAD,EAAK4J,KAAL,EAAY;AAAE5H,MAAAA,KAAK,EAAEA;AAAT,KAAZ,CAA/C,CAAP;AAAuF,GAAhI;;AACA,MAAIoH,0BAA0B,GAAG,UAAUQ,KAAV,EAAiB;AAAE,WAAQnK,gBAAgB,CAACE,aAAjB,CAA+B+J,iBAA/B,EAAkD1J,QAAQ,CAAC,EAAD,EAAK4J,KAAL,EAAY;AAAE5H,MAAAA,KAAK,EAAEA;AAAT,KAAZ,CAA1D,CAAR;AAAoG,GAAxJ;;AACA,MAAIwO,gCAAgC,GAAG,YAAY;AAAE,WAAQ/Q,gBAAgB,CAACE,aAAjB,CAA+ByJ,0BAA/B,EAA2D,IAA3D,EAAiE,UAAUQ,KAAV,EAAiB;AAAE,aAAOnK,gBAAgB,CAACE,aAAjB,CAA+B6J,uBAA/B,EAAwDxJ,QAAQ,CAAC,EAAD,EAAK4J,KAAL,CAAhE,CAAP;AAAsF,KAA1K,CAAR;AAAuL,GAA5O;;AACA,MAAI6G,YAAY,GAAG,UAAUC,iBAAV,EAA6B;AAC5C,QAAIC,WAAW,GAAGD,iBAAiB,CAACE,IAApC;;AACA,QAAID,WAAW,CAACE,OAAhB,EAAyB;AACrBF,MAAAA,WAAW,CAACE,OAAZ,CAAoB9J,QAApB,GAAgCtH,gBAAgB,CAACE,aAAjB,CAA+BF,gBAAgB,CAACyH,QAAhD,EAA0D,IAA1D,EAC5BhG,KAAK,CAACwP,iBAAiB,CAACtO,GAAlB,CAAsBwC,QAAvB,CAAL,CACKC,IADL,CACU,CADV,EAEKC,GAFL,CAES,UAAUC,CAAV,EAAa4J,KAAb,EAAoB;AAAE,eAAQlP,gBAAgB,CAACE,aAAjB,CAA+B4L,OAA/B,EAAwC;AAAEuF,UAAAA,GAAG,EAAEnC,KAAP;AAAc3J,UAAAA,SAAS,EAAE2J,KAAzB;AAAgC3M,UAAAA,KAAK,EAAEA,KAAvC;AAA8CwJ,UAAAA,kBAAkB,EAAEA;AAAlE,SAAxC,CAAR;AAA2I,OAF1K,CAD4B,EAI5BmF,WAAW,CAACE,OAAZ,CAAoB9J,QAJQ,CAAhC;AAKH;;AACD,WAAO4J,WAAP;AACH,GAVD;;AAWA,MAAII,iBAAiB,GAAG,UAAUpP,OAAV,EAAmB;AACvC,WAAOT,KAAK,CAAC8P,OAAN,CAAcrP,OAAd,IAAyBA,OAAO,CAACmD,GAAR,CAAY,UAAU3F,CAAV,EAAa;AAAE,aAAO2C,sBAAsB,CAAC3C,CAAD,CAA7B;AAAmC,KAA9D,CAAzB,GAA2F,CAAC2C,sBAAsB,CAACH,OAAD,CAAvB,CAAlG;AACH,GAFD;;AAGA,SAAO;AACHsP,IAAAA,OAAO,EAAE,UAAUC,eAAV,EAA2B;AAChC,UAAIvP,OAAO,GAAGiI,KAAK,IAAIA,KAAK,CAACjI,OAAf,GAAyBoP,iBAAiB,CAACnH,KAAK,CAACjI,OAAP,CAA1C,GAA4D,CAACN,oBAAD,CAA1E;AACAW,MAAAA,KAAK,CAACqC,MAAN,CAAa,mBAAb,EAAkC6M,eAAe,CAACC,iBAAlD;AACAnP,MAAAA,KAAK,CAACqC,MAAN,CAAa,YAAb,EAA2B6M,eAAe,CAACjL,UAA3C;AACAjE,MAAAA,KAAK,CAACqC,MAAN,CAAa,SAAb,EAAwB1C,OAAxB;AACH,KANE;AAOH8O,IAAAA,YAAY,EAAEA,YAPX;AAQHW,IAAAA,SAAS,EAAE,UAAUxH,KAAV,EAAiB;AACxB,UAAIoC,YAAY,GAAGhK,KAAK,CAAC1C,GAAN,CAAU,cAAV,CAAnB;;AACA,UAAI0M,YAAJ,EAAkB;AACdA,QAAAA,YAAY,CAACqF,KAAb;AACH;AACJ,KAbE;AAcHC,IAAAA,cAAc,EAAE,UAAU1H,KAAV,EAAiB;AAC7B5H,MAAAA,KAAK,CAACqC,MAAN,CAAa,KAAb,EAAoBuF,KAAK,CAACxH,GAA1B;AACH,KAhBE;AAiBHmP,IAAAA,iBAAiB,EAAE,UAAU3H,KAAV,EAAiB;AAChC,UAAIoC,YAAY,GAAGhK,KAAK,CAAC1C,GAAN,CAAU,cAAV,CAAnB;;AACA,UAAI0M,YAAJ,EAAkB;AACdA,QAAAA,YAAY,GAAGA,YAAY,CAACwF,GAAb,CAAiB5H,KAAK,CAAC5E,SAAvB,EAAkC4E,KAAlC,CAAf;AACA5H,QAAAA,KAAK,CAACqC,MAAN,CAAa,cAAb,EAA6B2H,YAA7B;AACH;AACJ,KAvBE;AAwBH/E,IAAAA,MAAM,EAAEsJ,eAxBL;AAyBH7G,IAAAA,iBAAiB,EAAEN,0BAzBhB;AA0BHI,IAAAA,uBAAuB,EAAEgH,gCA1BtB;AA2BHiB,IAAAA,eAAe,EAAE,YAAY;AACzBrN,MAAAA,YAAY;AACf,KA7BE;AA8BHqI,IAAAA,SAAS,EAAE,UAAU9K,OAAV,EAAmB;AAC1B,UAAIkB,QAAQ,GAAG3B,KAAK,CAAC8P,OAAN,CAAcrP,OAAd,IAAyBA,OAAzB,GAAmC,CAACA,OAAD,CAAlD;AACAmB,MAAAA,WAAW,CAACD,QAAD,CAAX;AACAe,MAAAA,SAAS,CAACf,QAAD,CAAT;AACH,KAlCE;AAmCHqB,IAAAA,eAAe,EAAEA,eAnCd;AAoCHJ,IAAAA,mBAAmB,EAAEA;AApClB,GAAP;AAsCH,CA/DD;;AAiEAvF,OAAO,CAACmB,QAAR,GAAmBA,QAAnB;AACAnB,OAAO,CAACuB,YAAR,GAAuBA,YAAvB;AACAvB,OAAO,CAACwB,UAAR,GAAqBA,UAArB;AACAxB,OAAO,CAAC4R,YAAR,GAAuBA,YAAvB","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nvar React = require('react');\nvar core = require('@react-pdf-viewer/core');\n\nfunction _interopNamespace(e) {\n    if (e && e.__esModule) return e;\n    var n = Object.create(null);\n    if (e) {\n        Object.keys(e).forEach(function (k) {\n            if (k !== 'default') {\n                var d = Object.getOwnPropertyDescriptor(e, k);\n                Object.defineProperty(n, k, d.get ? d : {\n                    enumerable: true,\n                    get: function () {\n                        return e[k];\n                    }\n                });\n            }\n        });\n    }\n    n['default'] = e;\n    return Object.freeze(n);\n}\n\nvar React__namespace = /*#__PURE__*/_interopNamespace(React);\n\nvar NextIcon = function () {\n    return (React__namespace.createElement(core.Icon, { size: 16 },\n        React__namespace.createElement(\"path\", { d: \"M0.541,5.627L11.666,18.2c0.183,0.207,0.499,0.226,0.706,0.043c0.015-0.014,0.03-0.028,0.043-0.043\\n                L23.541,5.627\" })));\n};\n\nvar PreviousIcon = function () {\n    return (React__namespace.createElement(core.Icon, { size: 16 },\n        React__namespace.createElement(\"path\", { d: \"M23.535,18.373L12.409,5.8c-0.183-0.207-0.499-0.226-0.706-0.043C11.688,5.77,11.674,5.785,11.66,5.8\\n                L0.535,18.373\" })));\n};\n\nvar SearchIcon = function () {\n    return (React__namespace.createElement(core.Icon, { size: 16 },\n        React__namespace.createElement(\"path\", { d: \"M10.5,0.5c5.523,0,10,4.477,10,10s-4.477,10-10,10s-10-4.477-10-10S4.977,0.5,10.5,0.5z\\n                M23.5,23.5\\n                l-5.929-5.929\" })));\n};\n\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n\r\nvar __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\n\r\nfunction __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || from);\r\n}\n\nvar EMPTY_KEYWORD_REGEXP = new RegExp(' ');\n\nvar normalizeFlagKeyword = function (flagKeyword) {\n    var source = flagKeyword.wholeWords ? \" \" + flagKeyword.keyword + \" \" : flagKeyword.keyword;\n    var flags = flagKeyword.matchCase ? 'g' : 'gi';\n    return new RegExp(source, flags);\n};\nvar normalizeSingleKeyword = function (keyword, matchCase, wholeWords) {\n    if (keyword instanceof RegExp) {\n        return keyword;\n    }\n    if (typeof keyword === 'string') {\n        return keyword === ''\n            ? EMPTY_KEYWORD_REGEXP\n            : normalizeFlagKeyword({\n                keyword: keyword,\n                matchCase: matchCase || false,\n                wholeWords: wholeWords || false,\n            });\n    }\n    if (typeof matchCase !== 'undefined') {\n        keyword.matchCase = matchCase;\n    }\n    if (typeof wholeWords !== 'undefined') {\n        keyword.wholeWords = wholeWords;\n    }\n    return normalizeFlagKeyword(keyword);\n};\n\nvar useDocument = function (store) {\n    var currentDocRef = React__namespace.useRef(store.get('doc'));\n    var handleDocumentChanged = function (doc) {\n        currentDocRef.current = doc;\n    };\n    React__namespace.useEffect(function () {\n        store.subscribe('doc', handleDocumentChanged);\n        return function () {\n            store.unsubscribe('doc', handleDocumentChanged);\n        };\n    }, []);\n    return { currentDoc: currentDocRef.current };\n};\n\nvar useSearch = function (store) {\n    var currentDoc = useDocument(store).currentDoc;\n    var _a = React__namespace.useState([]), keywords = _a[0], setKeywords = _a[1];\n    var _b = React__namespace.useState([]), found = _b[0], setFound = _b[1];\n    var _c = React__namespace.useState(0), currentMatch = _c[0], setCurrentMatch = _c[1];\n    var _d = React__namespace.useState(false), matchCase = _d[0], setMatchCase = _d[1];\n    var textContents = React__namespace.useRef([]);\n    var _e = React__namespace.useState(false), wholeWords = _e[0], setWholeWords = _e[1];\n    var changeMatchCase = function (isChecked) {\n        setMatchCase(isChecked);\n        if (keywords.length > 0) {\n            searchFor(keywords, isChecked, wholeWords);\n        }\n    };\n    var changeWholeWords = function (isChecked) {\n        setWholeWords(isChecked);\n        if (keywords.length > 0) {\n            searchFor(keywords, matchCase, isChecked);\n        }\n    };\n    var jumpToPreviousMatch = function () {\n        if (keywords.length === 0 || found.length === 0) {\n            return;\n        }\n        var prev = currentMatch - 1;\n        var updated = prev > 0 ? prev : found.length;\n        setCurrentMatch(updated);\n        jumpToMatch(found[updated - 1]);\n    };\n    var jumpToNextMatch = function () {\n        if (keywords.length === 0 || found.length === 0) {\n            return;\n        }\n        var next = currentMatch + 1;\n        var updated = next <= found.length ? next : 1;\n        setCurrentMatch(updated);\n        jumpToMatch(found[updated - 1]);\n    };\n    var clearKeyword = function () {\n        if (keywords.length === 0) {\n            return;\n        }\n        store.update('keyword', [EMPTY_KEYWORD_REGEXP]);\n        setKeyword('');\n        setCurrentMatch(0);\n        setFound([]);\n        setMatchCase(false);\n        setWholeWords(false);\n    };\n    var search = function () { return searchFor(keywords, matchCase, wholeWords); };\n    var setKeyword = function (keyword) { return setKeywords(keyword === '' ? [] : [keyword]); };\n    var getTextContents = function () {\n        if (!currentDoc) {\n            return Promise.resolve([]);\n        }\n        var promises = Array(currentDoc.numPages)\n            .fill(0)\n            .map(function (_, pageIndex) {\n            return currentDoc\n                .getPage(pageIndex + 1)\n                .then(function (page) {\n                return page.getTextContent();\n            })\n                .then(function (content) {\n                var pageContent = content.items.map(function (item) { return item.str || ''; }).join('');\n                return Promise.resolve({\n                    pageContent: pageContent,\n                    pageIndex: pageIndex,\n                });\n            });\n        });\n        return Promise.all(promises).then(function (data) {\n            data.sort(function (a, b) { return a.pageIndex - b.pageIndex; });\n            return Promise.resolve(data.map(function (item) { return item.pageContent; }));\n        });\n    };\n    var jumpToMatch = function (match) {\n        var jumpToPage = store.get('jumpToPage');\n        if (jumpToPage) {\n            jumpToPage(match.pageIndex);\n        }\n        store.update('match', match);\n    };\n    var getKeywordSource = function (keyword) {\n        if (keyword instanceof RegExp) {\n            return keyword.source;\n        }\n        if (typeof keyword === 'string') {\n            return keyword;\n        }\n        return keyword.keyword;\n    };\n    var searchFor = function (keywordParam, matchCaseParam, wholeWordsParam) {\n        var keywords = keywordParam.map(function (k) { return normalizeSingleKeyword(k, matchCaseParam, wholeWordsParam); });\n        store.update('keyword', keywords);\n        setCurrentMatch(0);\n        setFound([]);\n        var promise = textContents.current.length === 0\n            ? getTextContents().then(function (response) {\n                textContents.current = response;\n                return Promise.resolve(response);\n            })\n            : Promise.resolve(textContents.current);\n        promise.then(function (response) {\n            var arr = [];\n            response.forEach(function (item, pageIndex) {\n                var numMatches = keywords.map(function (k) { return (item.match(k) || []).length; }).reduce(function (a, b) { return a + b; }, 0);\n                for (var matchIndex = 0; matchIndex < numMatches; matchIndex++) {\n                    arr.push({\n                        matchIndex: matchIndex,\n                        pageIndex: pageIndex,\n                    });\n                }\n            });\n            setFound(arr);\n            if (arr.length > 0) {\n                setCurrentMatch(1);\n                jumpToMatch(arr[0]);\n            }\n        });\n    };\n    React__namespace.useEffect(function () {\n        textContents.current = [];\n    }, [currentDoc]);\n    return {\n        clearKeyword: clearKeyword,\n        changeMatchCase: changeMatchCase,\n        changeWholeWords: changeWholeWords,\n        currentMatch: currentMatch,\n        jumpToNextMatch: jumpToNextMatch,\n        jumpToPreviousMatch: jumpToPreviousMatch,\n        keywords: keywords,\n        matchCase: matchCase,\n        numberOfMatches: found.length,\n        wholeWords: wholeWords,\n        search: search,\n        searchFor: searchFor,\n        setKeywords: setKeywords,\n        keyword: keywords.length === 0 ? '' : getKeywordSource(keywords[0]),\n        setKeyword: setKeyword,\n    };\n};\n\nvar Inner = function (_a) {\n    var children = _a.children, store = _a.store;\n    var result = useSearch(store);\n    return children(__assign({}, result));\n};\nvar Search = function (_a) {\n    var children = _a.children, store = _a.store;\n    var currentDoc = useDocument(store).currentDoc;\n    return currentDoc ? React__namespace.createElement(Inner, { store: store }, children) : React__namespace.createElement(React__namespace.Fragment, null);\n};\n\nvar PORTAL_OFFSET$1 = { left: 0, top: 8 };\nvar SearchPopover = function (_a) {\n    var store = _a.store, onToggle = _a.onToggle;\n    var l10n = React__namespace.useContext(core.LocalizationContext);\n    var _b = useSearch(store), clearKeyword = _b.clearKeyword, changeMatchCase = _b.changeMatchCase, changeWholeWords = _b.changeWholeWords, currentMatch = _b.currentMatch, jumpToNextMatch = _b.jumpToNextMatch, jumpToPreviousMatch = _b.jumpToPreviousMatch, keyword = _b.keyword, matchCase = _b.matchCase, numberOfMatches = _b.numberOfMatches, wholeWords = _b.wholeWords, search = _b.search, setKeyword = _b.setKeyword;\n    var onKeydownSearch = function (e) {\n        if (e.keyCode !== 13 || !keyword) {\n            return;\n        }\n        search();\n    };\n    var onChangeMatchCase = function (e) {\n        changeMatchCase(e.target.checked);\n    };\n    var onChangeWholeWords = function (e) {\n        changeWholeWords(e.target.checked);\n    };\n    var onClose = function () {\n        onToggle();\n        clearKeyword();\n    };\n    return (React__namespace.createElement(\"div\", { className: \"rpv-search__popover\" },\n        React__namespace.createElement(\"div\", { className: \"rpv-search__popover-input-counter\" },\n            React__namespace.createElement(core.TextBox, { placeholder: (l10n && l10n.search ? l10n.search.enterToSearch : 'Enter to search'), type: \"text\", value: keyword, onChange: setKeyword, onKeyDown: onKeydownSearch }),\n            React__namespace.createElement(\"div\", { className: \"rpv-search__popover-counter\" },\n                currentMatch,\n                \"/\",\n                numberOfMatches)),\n        React__namespace.createElement(\"label\", { className: \"rpv-search__popover-label\" },\n            React__namespace.createElement(\"input\", { className: \"rpv-search__popover-label-checkbox\", checked: matchCase, type: \"checkbox\", onChange: onChangeMatchCase }),\n            ' ',\n            l10n && l10n.search ? l10n.search.matchCase : 'Match case'),\n        React__namespace.createElement(\"label\", { className: \"rpv-search__popover-label\" },\n            React__namespace.createElement(\"input\", { className: \"rpv-search__popover-label-checkbox\", checked: wholeWords, type: \"checkbox\", onChange: onChangeWholeWords }),\n            ' ',\n            l10n && l10n.search ? l10n.search.wholeWords : 'Whole words'),\n        React__namespace.createElement(\"div\", { className: \"rpv-search__popover-footer\" },\n            React__namespace.createElement(\"div\", { className: \"rpv-search__popover-footer-item\" },\n                React__namespace.createElement(core.Tooltip, { position: core.Position.BottomCenter, target: React__namespace.createElement(core.MinimalButton, { onClick: jumpToPreviousMatch },\n                        React__namespace.createElement(PreviousIcon, null)), content: function () { return (l10n && l10n.search ? l10n.search.previousMatch : 'Previous match'); }, offset: PORTAL_OFFSET$1 })),\n            React__namespace.createElement(\"div\", { className: \"rpv-search__popover-footer-item\" },\n                React__namespace.createElement(core.Tooltip, { position: core.Position.BottomCenter, target: React__namespace.createElement(core.MinimalButton, { onClick: jumpToNextMatch },\n                        React__namespace.createElement(NextIcon, null)), content: function () { return (l10n && l10n.search ? l10n.search.nextMatch : 'Next match'); }, offset: PORTAL_OFFSET$1 })),\n            React__namespace.createElement(\"div\", { className: \"rpv-search__popover-footer-button\" },\n                React__namespace.createElement(core.Button, { onClick: onClose }, l10n && l10n.search ? l10n.search.close : 'Close')))));\n};\n\nvar ShowSearchPopoverDecorator = function (_a) {\n    var children = _a.children, onClick = _a.onClick;\n    var l10n = React__namespace.useContext(core.LocalizationContext);\n    var label = (l10n && l10n.search ? l10n.search.search : 'Search');\n    var icon = React__namespace.createElement(SearchIcon, null);\n    return children({ icon: icon, label: label, onClick: onClick });\n};\n\nvar TOOLTIP_OFFSET = { left: 0, top: 8 };\nvar ShowSearchPopoverButton = function (_a) {\n    var onClick = _a.onClick;\n    return (React__namespace.createElement(ShowSearchPopoverDecorator, { onClick: onClick }, function (p) { return (React__namespace.createElement(core.Tooltip, { position: core.Position.BottomCenter, target: React__namespace.createElement(core.MinimalButton, { onClick: onClick }, p.icon), content: function () { return p.label; }, offset: TOOLTIP_OFFSET })); }));\n};\n\nvar PORTAL_OFFSET = { left: 0, top: 8 };\nvar ShowSearchPopover = function (_a) {\n    var children = _a.children, store = _a.store;\n    var currentDoc = useDocument(store).currentDoc;\n    var defaultChildren = function (props) { return React__namespace.createElement(ShowSearchPopoverButton, __assign({}, props)); };\n    var render = children || defaultChildren;\n    return currentDoc ? (React__namespace.createElement(core.Popover, { position: core.Position.BottomLeft, target: function (toggle) {\n            return render({\n                onClick: toggle,\n            });\n        }, content: function (toggle) { return React__namespace.createElement(SearchPopover, { store: store, onToggle: toggle }); }, offset: PORTAL_OFFSET, closeOnClickOutside: false, closeOnEscape: true })) : (React__namespace.createElement(React__namespace.Fragment, null));\n};\n\nvar calculateOffset = function (children, parent) {\n    var top = children.offsetTop;\n    var left = children.offsetLeft;\n    var p = children.parentElement;\n    while (p && p !== parent) {\n        top += p.offsetTop;\n        left += p.offsetLeft;\n        p = p.parentElement;\n    }\n    return {\n        left: left,\n        top: top,\n    };\n};\n\nvar removeNode = function (ele) {\n    var parent = ele.parentNode;\n    if (parent) {\n        parent.removeChild(ele);\n    }\n};\nvar replaceNode = function (replacementNode, node) {\n    removeNode(replacementNode);\n    var parent = node.parentNode;\n    if (parent) {\n        parent.insertBefore(replacementNode, node);\n    }\n    removeNode(node);\n};\nvar unwrap = function (ele) {\n    var parent = ele.parentNode;\n    if (!parent) {\n        return;\n    }\n    var range = document.createRange();\n    range.selectNodeContents(ele);\n    replaceNode(range.extractContents(), ele);\n    parent.normalize();\n};\n\nvar Tracker = function (_a) {\n    var pageIndex = _a.pageIndex, store = _a.store, onHighlightKeyword = _a.onHighlightKeyword;\n    var _b = React__namespace.useState({\n        matchIndex: -1,\n        pageIndex: -1,\n    }), match = _b[0], setMatch = _b[1];\n    var _c = React__namespace.useState([EMPTY_KEYWORD_REGEXP]), keywordRegexp = _c[0], setKeywordRegexp = _c[1];\n    var _d = React__namespace.useState({\n        pageIndex: pageIndex,\n        scale: 1,\n        status: core.LayerRenderStatus.PreRender,\n    }), renderStatus = _d[0], setRenderStatus = _d[1];\n    var currentMatchRef = React__namespace.useRef(null);\n    var characterIndexesRef = React__namespace.useRef([]);\n    var unhighlightAll = function (containerEle) {\n        var highlightNodes = containerEle.querySelectorAll('span.rpv-search__highlight');\n        var total = highlightNodes.length;\n        for (var i = 0; i < total; i++) {\n            highlightNodes[i].parentElement.removeChild(highlightNodes[i]);\n        }\n    };\n    var highlight = function (keyword, containerEle, span, charIndexSpan) {\n        var range = document.createRange();\n        var firstChild = span.firstChild;\n        if (!firstChild) {\n            return;\n        }\n        var startOffset = charIndexSpan[0].charIndexInSpan;\n        var endOffset = charIndexSpan.length === 1 ? startOffset : charIndexSpan[charIndexSpan.length - 1].charIndexInSpan;\n        range.setStart(firstChild, startOffset);\n        range.setEnd(firstChild, endOffset + 1);\n        var wrapper = document.createElement('span');\n        range.surroundContents(wrapper);\n        var wrapperRect = wrapper.getBoundingClientRect();\n        var containerRect = containerEle.getBoundingClientRect();\n        var highlightEle = document.createElement('span');\n        containerEle.appendChild(highlightEle);\n        highlightEle.style.left = (100 * (wrapperRect.left - containerRect.left)) / containerRect.width + \"%\";\n        highlightEle.style.top = (100 * (wrapperRect.top - containerRect.top)) / containerRect.height + \"%\";\n        highlightEle.style.width = (100 * wrapperRect.width) / containerRect.width + \"%\";\n        highlightEle.style.height = (100 * wrapperRect.height) / containerRect.height + \"%\";\n        highlightEle.classList.add('rpv-search__highlight');\n        highlightEle.setAttribute('title', keyword.source.trim());\n        unwrap(wrapper);\n        if (onHighlightKeyword) {\n            onHighlightKeyword({\n                highlightEle: highlightEle,\n                keyword: keyword,\n            });\n        }\n    };\n    var highlightAll = function (containerEle) {\n        var charIndexes = characterIndexesRef.current;\n        if (charIndexes.length === 0) {\n            return;\n        }\n        var spans = [].slice.call(containerEle.querySelectorAll('.rpv-core__text-layer-text'));\n        var fullText = charIndexes.map(function (item) { return item.char; }).join('');\n        keywordRegexp.forEach(function (keyword) {\n            var keywordStr = keyword.source;\n            if (!keywordStr.trim()) {\n                return;\n            }\n            var cloneKeyword = keyword.flags.indexOf('g') === -1 ? new RegExp(keyword, keyword.flags + \"g\") : keyword;\n            var match;\n            var matches = [];\n            while ((match = cloneKeyword.exec(fullText)) !== null) {\n                matches.push({\n                    keyword: cloneKeyword,\n                    startIndex: match.index,\n                    endIndex: cloneKeyword.lastIndex,\n                });\n            }\n            matches\n                .map(function (item) { return ({\n                keyword: item.keyword,\n                indexes: charIndexes.slice(item.startIndex, item.endIndex),\n            }); })\n                .forEach(function (item) {\n                var spanIndexes = item.indexes.reduce(function (acc, item) {\n                    acc[item.spanIndex] = __spreadArray(__spreadArray([], (acc[item.spanIndex] || [])), [item]);\n                    return acc;\n                }, {});\n                Object.values(spanIndexes).forEach(function (charIndexSpan) {\n                    highlight(item.keyword, containerEle, spans[charIndexSpan[0].spanIndex], charIndexSpan);\n                });\n            });\n        });\n    };\n    var handleKeywordChanged = function (keyword) {\n        if (keyword && keyword.length > 0) {\n            setKeywordRegexp(keyword);\n        }\n    };\n    var handleMatchChanged = function (currentMatch) {\n        setMatch(currentMatch);\n    };\n    var handleRenderStatusChanged = function (status) {\n        if (!status.has(pageIndex)) {\n            return;\n        }\n        var currentStatus = status.get(pageIndex);\n        if (currentStatus) {\n            setRenderStatus({\n                ele: currentStatus.ele,\n                pageIndex: pageIndex,\n                scale: currentStatus.scale,\n                status: currentStatus.status,\n            });\n        }\n    };\n    var isEmptyKeyword = function () {\n        return keywordRegexp.length === 0 || (keywordRegexp.length === 1 && keywordRegexp[0].source.trim() === '');\n    };\n    React__namespace.useEffect(function () {\n        if (isEmptyKeyword() ||\n            renderStatus.status !== core.LayerRenderStatus.DidRender ||\n            characterIndexesRef.current.length) {\n            return;\n        }\n        var containerEle = renderStatus.ele;\n        var spans = [].slice.call(containerEle.querySelectorAll('.rpv-core__text-layer-text'));\n        var charIndexes = spans\n            .map(function (span) { return span.textContent; })\n            .reduce(function (prev, curr, index) {\n            return prev.concat(curr.split('').map(function (c, i) { return ({\n                char: c,\n                charIndexInSpan: i,\n                spanIndex: index,\n            }); }));\n        }, [\n            {\n                char: '',\n                charIndexInSpan: 0,\n                spanIndex: 0,\n            },\n        ])\n            .slice(1);\n        characterIndexesRef.current = charIndexes;\n    }, [keywordRegexp, renderStatus.status]);\n    React__namespace.useEffect(function () {\n        if (isEmptyKeyword() || !renderStatus.ele || renderStatus.status !== core.LayerRenderStatus.DidRender) {\n            return;\n        }\n        var containerEle = renderStatus.ele;\n        unhighlightAll(containerEle);\n        highlightAll(containerEle);\n        scrollToMatch();\n    }, [keywordRegexp, match, renderStatus.status, characterIndexesRef.current]);\n    React__namespace.useEffect(function () {\n        if (isEmptyKeyword() && renderStatus.ele && renderStatus.status === core.LayerRenderStatus.DidRender) {\n            unhighlightAll(renderStatus.ele);\n        }\n    }, [keywordRegexp, renderStatus.status]);\n    var scrollToMatch = function () {\n        if (match.pageIndex !== pageIndex || !renderStatus.ele || renderStatus.status !== core.LayerRenderStatus.DidRender) {\n            return;\n        }\n        var container = renderStatus.ele;\n        var spans = container.querySelectorAll('.rpv-search__highlight');\n        if (match.matchIndex < spans.length) {\n            var span = spans[match.matchIndex];\n            var _a = calculateOffset(span, container), left = _a.left, top_1 = _a.top;\n            var jump = store.get('jumpToDestination');\n            if (jump) {\n                jump(pageIndex, (container.getBoundingClientRect().height - top_1) / renderStatus.scale, left / renderStatus.scale, renderStatus.scale);\n                if (currentMatchRef.current) {\n                    currentMatchRef.current.classList.remove('rpv-search__highlight--current');\n                }\n                currentMatchRef.current = span;\n                span.classList.add('rpv-search__highlight--current');\n            }\n        }\n    };\n    React__namespace.useEffect(function () {\n        store.subscribe('keyword', handleKeywordChanged);\n        store.subscribe('match', handleMatchChanged);\n        store.subscribe('renderStatus', handleRenderStatusChanged);\n        return function () {\n            store.unsubscribe('keyword', handleKeywordChanged);\n            store.unsubscribe('match', handleMatchChanged);\n            store.unsubscribe('renderStatus', handleRenderStatusChanged);\n        };\n    }, []);\n    return React__namespace.createElement(React__namespace.Fragment, null);\n};\n\nvar searchPlugin = function (props) {\n    var onHighlightKeyword = React__namespace.useMemo(function () { return (props && props.onHighlightKeyword ? props.onHighlightKeyword : function () { }); }, []);\n    var store = React__namespace.useMemo(function () {\n        return core.createStore({\n            renderStatus: new Map(),\n        });\n    }, []);\n    var _a = useSearch(store), clearKeyword = _a.clearKeyword, jumpToNextMatch = _a.jumpToNextMatch, jumpToPreviousMatch = _a.jumpToPreviousMatch, searchFor = _a.searchFor, setKeywords = _a.setKeywords;\n    var SearchDecorator = function (props) { return React__namespace.createElement(Search, __assign({}, props, { store: store })); };\n    var ShowSearchPopoverDecorator = function (props) { return (React__namespace.createElement(ShowSearchPopover, __assign({}, props, { store: store }))); };\n    var ShowSearchPopoverButtonDecorator = function () { return (React__namespace.createElement(ShowSearchPopoverDecorator, null, function (props) { return React__namespace.createElement(ShowSearchPopoverButton, __assign({}, props)); })); };\n    var renderViewer = function (renderViewerProps) {\n        var currentSlot = renderViewerProps.slot;\n        if (currentSlot.subSlot) {\n            currentSlot.subSlot.children = (React__namespace.createElement(React__namespace.Fragment, null,\n                Array(renderViewerProps.doc.numPages)\n                    .fill(0)\n                    .map(function (_, index) { return (React__namespace.createElement(Tracker, { key: index, pageIndex: index, store: store, onHighlightKeyword: onHighlightKeyword })); }),\n                currentSlot.subSlot.children));\n        }\n        return currentSlot;\n    };\n    var normalizeKeywords = function (keyword) {\n        return Array.isArray(keyword) ? keyword.map(function (k) { return normalizeSingleKeyword(k); }) : [normalizeSingleKeyword(keyword)];\n    };\n    return {\n        install: function (pluginFunctions) {\n            var keyword = props && props.keyword ? normalizeKeywords(props.keyword) : [EMPTY_KEYWORD_REGEXP];\n            store.update('jumpToDestination', pluginFunctions.jumpToDestination);\n            store.update('jumpToPage', pluginFunctions.jumpToPage);\n            store.update('keyword', keyword);\n        },\n        renderViewer: renderViewer,\n        uninstall: function (props) {\n            var renderStatus = store.get('renderStatus');\n            if (renderStatus) {\n                renderStatus.clear();\n            }\n        },\n        onDocumentLoad: function (props) {\n            store.update('doc', props.doc);\n        },\n        onTextLayerRender: function (props) {\n            var renderStatus = store.get('renderStatus');\n            if (renderStatus) {\n                renderStatus = renderStatus.set(props.pageIndex, props);\n                store.update('renderStatus', renderStatus);\n            }\n        },\n        Search: SearchDecorator,\n        ShowSearchPopover: ShowSearchPopoverDecorator,\n        ShowSearchPopoverButton: ShowSearchPopoverButtonDecorator,\n        clearHighlights: function () {\n            clearKeyword();\n        },\n        highlight: function (keyword) {\n            var keywords = Array.isArray(keyword) ? keyword : [keyword];\n            setKeywords(keywords);\n            searchFor(keywords);\n        },\n        jumpToNextMatch: jumpToNextMatch,\n        jumpToPreviousMatch: jumpToPreviousMatch,\n    };\n};\n\nexports.NextIcon = NextIcon;\nexports.PreviousIcon = PreviousIcon;\nexports.SearchIcon = SearchIcon;\nexports.searchPlugin = searchPlugin;\n"]},"metadata":{},"sourceType":"script"}