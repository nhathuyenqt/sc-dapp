{"ast":null,"code":"var _jsxFileName = \"/Users/kzjouf/Desktop/project/scdapp/src/pages/Posts.js\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport xtype from 'xtypejs';\nimport AddPost from '../components/AddPost';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport DialogActions from \"@material-ui/core/DialogActions\";\nimport DialogContent from \"@material-ui/core/DialogContent\";\nimport DialogContentText from \"@material-ui/core/DialogContentText\";\nimport Dialog from '@material-ui/core/Dialog';\nimport { Typography, Button, TextField, Grid } from '@material-ui/core';\nimport IconButton from '@material-ui/core/IconButton';\nimport { DataGrid } from '@material-ui/data-grid';\nimport XContract from './../artifacts/contracts/XContract.sol/XContract.json';\nimport text from './../contract_address.json';\nimport { ethers } from 'ethers';\nimport { useState, useEffect } from 'react';\nimport { makeStyles } from '@material-ui/styles';\nimport { green } from '@material-ui/core/colors';\nimport SendIcon from '@material-ui/icons/Send';\nimport VisibilityIcon from '@material-ui/icons/Visibility';\nimport DealDialog from './components/Deal';\nimport NewPostDialog from './components/NewPost';\nimport PropTypes from 'prop-types';\nimport { useAuth } from \"../helper/AuthContext\";\nimport { useHistory } from 'react-router-dom';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst contractAddress = text['contract_address'];\n\nfunction Posts(props) {\n  _s();\n\n  const {\n    currentBCAccount,\n    keypair,\n    loading,\n    balance\n  } = useAuth();\n  const [postList, setPostList] = useState([]);\n  const [yourPostList, setYourPostList] = useState([]);\n  const [open, setOpen] = useState(false);\n  const [openOffer, setOpenOffer] = useState(false);\n  const [openNewPost, setOpenNewPost] = useState(false);\n  const [selectedItem, setSelectedItem] = useState({\n    id: '',\n    description: '',\n    pubkey: '',\n    state: ''\n  });\n  const [deal, setDeal] = useState();\n  const [minOffer, setMinOffer] = useState();\n  const classes = useStyles();\n  let history = useHistory();\n  const State = ['Processing', 'Assigned', 'WaitingPayValidation', 'Closed', 'Cancel'];\n  const columns = [{\n    field: 'id',\n    headerName: 'ID',\n    width: 68,\n    headerClassName: 'super-app-theme--header'\n  }, {\n    field: 'description',\n    headerName: 'Description',\n    headerClassName: 'super-app-theme--header',\n    flex: 1\n  }, // {\n  //     field: 'id',\n  //     headerName: 'id',\n  //     type: 'number',\n  //     width: 50,\n  //     editable: true,\n  //   }\n  {\n    field: 'action',\n    headerName: 'Action',\n    headerClassName: 'super-app-theme--header',\n    width: 150,\n    renderCell: params => /*#__PURE__*/_jsxDEV(\"strong\", {\n      children: /*#__PURE__*/_jsxDEV(Button, {\n        variant: \"outlined\",\n        color: \"secondary\",\n        size: \"small\",\n        onClick: () => handleClickOpen(params),\n        children: \"Offer a price\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 62,\n        columnNumber: 13\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 60,\n      columnNumber: 11\n    }, this),\n    disableClickEventBubbling: true\n  }];\n  const columns2 = [{\n    field: 'id',\n    headerName: 'ID',\n    width: 68,\n    headerClassName: 'super-app-theme--Filled',\n    sortDescendingFirst: true\n  }, {\n    field: 'description',\n    headerName: 'Description',\n    headerClassName: 'super-app-theme--Filled',\n    flex: 1\n  }, {\n    field: 'state',\n    headerName: 'State',\n    headerClassName: 'super-app-theme--Filled',\n    flex: 1\n  }, {\n    field: 'minprice',\n    headerName: 'Min Price',\n    headerClassName: 'super-app-theme--Filled',\n    width: 150,\n    renderCell: params => /*#__PURE__*/_jsxDEV(\"strong\", {\n      children: /*#__PURE__*/_jsxDEV(IconButton, {\n        style: {\n          color: green[500]\n        },\n        size: \"small\",\n        onClick: () => loadMinOffer(params.row),\n        children: /*#__PURE__*/_jsxDEV(VisibilityIcon, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 100,\n          columnNumber: 15\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 13\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 11\n    }, this),\n    disableClickEventBubbling: true\n  }, {\n    field: 'action',\n    headerName: 'Action',\n    headerClassName: 'super-app-theme--Filled',\n    width: 150,\n    renderCell: params => /*#__PURE__*/_jsxDEV(\"strong\", {\n      children: [/*#__PURE__*/_jsxDEV(Button, {\n        variant: \"contained\",\n        color: \"primary\",\n        size: \"small\",\n        alignItem: \"center\",\n        disabled: params.row.state == 'Assigned' || params.row.state == 'WaitingPayValidation' ? false : true,\n        onClick: () => handlePay(params),\n        children: \"Pay\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 113,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(Button, {\n        variant: \"contained\",\n        color: \"primary\",\n        size: \"small\",\n        alignItem: \"center\",\n        style: {\n          margin: '10px'\n        },\n        disabled: params.row.state == 'Processing' || params.row.state == 'Assigned' ? false : true,\n        onClick: () => handleCancel(params.row),\n        children: \"Cancel\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 122,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 11\n    }, this),\n    disableClickEventBubbling: true\n  }];\n  setTimeout(() => {\n    listenEvents();\n  }, 5000);\n\n  const handleClickLoad = params => {\n    setSelectedItem(params.row);\n  };\n\n  const handlePay = () => {\n    history.push(\"/\");\n  };\n\n  async function handleCancel(item) {\n    setSelectedItem(item);\n    const response = await fetch(\"/cancelRequest\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        'user_key': currentBCAccount.privateKey,\n        'id': item.id,\n        'x': keypair.x\n      })\n    });\n    let result;\n    let newPosts = [];\n    await response.json().then(message => {\n      reload();\n    }); // history.push(\"/\")\n  }\n\n  ;\n\n  const handleCloseOffer = value => {\n    setOpenOffer(false);\n    setSelectedItem(value);\n  };\n\n  const handleClickOpen = params => {\n    console.log(params.row);\n    setSelectedItem(params.row);\n    setOpen(true);\n  };\n\n  const handleClose = value => {\n    setOpen(false);\n    setSelectedItem(value);\n    reload();\n  };\n\n  const handlePost = () => {\n    setOpenNewPost(true);\n  };\n\n  const handleCloseNewPost = () => {\n    setOpenNewPost(false);\n    reload();\n  };\n\n  async function loadTasks() {\n    console.log(\"key \", currentBCAccount.privateKey);\n    const response = await fetch(\"/loadTasks\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        'user_key': currentBCAccount.privateKey\n      })\n    });\n    let result;\n    let newPosts = [];\n    await response.json().then(message => {\n      result = message[\"data\"];\n      result.map(task => {\n        newPosts.push({\n          id: task[0],\n          description: task[1],\n          pubkey: task[2]\n        });\n      });\n      setPostList(newPosts);\n    }); // await listenEvents()\n\n    return result;\n  }\n\n  async function loadYourTasks() {\n    const response = await fetch(\"/loadYourTasks\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        'user_key': currentBCAccount.privateKey\n      })\n    });\n    let result;\n    let newYourPosts = [];\n    await response.json().then(message => {\n      result = message[\"data\"];\n      result.map(task => {\n        newYourPosts.push({\n          id: task[0],\n          description: task[1],\n          pubkey: task[2],\n          state: State[task[3]]\n        });\n      });\n      setYourPostList(newYourPosts);\n    }); // await listenEvents()\n\n    return result;\n  }\n\n  async function loadMinOffer(item) {\n    setSelectedItem(item);\n    const response = await fetch(\"/loadMinOffer\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        'user_key': currentBCAccount.privateKey,\n        'id': item.id,\n        'x': keypair.x\n      })\n    });\n    let result;\n    let newPosts = [];\n    await response.json().then(message => {\n      result = message[\"min_offer\"];\n      let newdeal = result['deal'];\n      let raw_price = result['raw_price'];\n      setDeal(newdeal);\n      setMinOffer(raw_price);\n      setOpenOffer(true);\n    });\n  } // async function listenEvents(){\n  //   if (typeof window.ethereum !== 'undefined'){\n  //     const provider = new ethers.providers.Web3Provider(window.ethereum);\n  //     const contract = new ethers.Contract(contractAddress, XContract.abi, provider);\n  //     contract.on(\"NewPrice\", (id, CL_price, CR_price) => {\n  //       console.log(\"event \", id, CL_price, CR_price);\n  //     })\n  //     // console.log(contract.events)\n  //     // await contract.events.NewPrice({}).on(\"data\", (e) => console.log(e));\n  //   }\n  // }\n\n\n  useEffect(() => {\n    reload();\n  }, []);\n\n  const reload = async () => {\n    console.log(\"Closed..\");\n    await loadTasks();\n    await loadYourTasks();\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      height: '800px',\n      marginLeft: 100,\n      marginRight: 20\n    },\n    className: classes.root,\n    children: [/*#__PURE__*/_jsxDEV(Grid, {\n      container: true,\n      \"align-items\": \"center\",\n      style: {\n        width: '100%',\n        height: \"100%\"\n      },\n      children: [/*#__PURE__*/_jsxDEV(Grid, {\n        item: true,\n        xs: true,\n        style: {\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'right'\n        },\n        children: [/*#__PURE__*/_jsxDEV(Button, {\n          size: \"small\",\n          variant: \"outlined\",\n          color: \"primary\",\n          style: {\n            margin: '10px'\n          },\n          onClick: handlePost,\n          children: \" ADD POST \"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 313,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          size: \"small\",\n          variant: \"outlined\",\n          color: \"primary\",\n          onClick: reload,\n          children: \" RELOAD \"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 314,\n          columnNumber: 17\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 312,\n        columnNumber: 15\n      }, this), /*#__PURE__*/_jsxDEV(Grid, {\n        item: true,\n        xs: 12,\n        style: {\n          height: \"42%\"\n        },\n        children: [/*#__PURE__*/_jsxDEV(Typography, {\n          variant: \"h5\",\n          align: \"center\",\n          component: \"h2\",\n          style: {\n            color: \"#ab3402\"\n          },\n          children: \" ALL AVAILABLE TASKS \"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 317,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(DataGrid, {\n          rows: postList,\n          columns: columns,\n          pageSize: 8 //   checkboxSelection\n          ,\n          disableSelectionOnClick: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 318,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(SimpleDialog, {\n          selectedItem: selectedItem,\n          open: open,\n          onClose: handleClose\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 325,\n          columnNumber: 17\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 316,\n        columnNumber: 15\n      }, this), /*#__PURE__*/_jsxDEV(Grid, {\n        item: true,\n        xs: 12,\n        style: {\n          height: \"42%\"\n        },\n        children: [/*#__PURE__*/_jsxDEV(Typography, {\n          variant: \"h6\",\n          align: \"center\",\n          component: \"h2\",\n          color: \"textPrimary\",\n          style: {\n            marginTop: '10px'\n          },\n          children: \" YOUR POSTING \"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 329,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(DataGrid, {\n          rows: yourPostList,\n          columns: columns2,\n          pageSize: 8 //   checkboxSelection\n          ,\n          disableSelectionOnClick: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 330,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(DealDialog, {\n          selectedItem: selectedItem,\n          open: openOffer,\n          onClose: handleCloseOffer,\n          deal: deal,\n          price: minOffer\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 338,\n          columnNumber: 17\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 328,\n        columnNumber: 15\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 311,\n      columnNumber: 11\n    }, this), /*#__PURE__*/_jsxDEV(NewPostDialog, {\n      open: openNewPost,\n      onClose: handleCloseNewPost\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 342,\n      columnNumber: 11\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 310,\n    columnNumber: 9\n  }, this);\n}\n\n_s(Posts, \"tL4UAbLra35ujhTx1v9DFE8rclA=\", false, function () {\n  return [useAuth, useStyles, useHistory];\n});\n\n_c = Posts;\nconst useStyles = makeStyles({\n  root: {\n    '& .super-app-theme--header': {\n      backgroundColor: '#ab3402',\n      color: 'white'\n    },\n    '& .super-app-theme--Filled': {\n      backgroundColor: '#094a14',\n      color: 'white',\n      fontFamily: 'Vazir',\n      fontWeight: 'bold'\n    }\n  }\n});\nexport default Posts;\n\nfunction SimpleDialog(props) {\n  _s2();\n\n  const classes = useStyles();\n  const {\n    currentBCAccount,\n    keypair,\n    loading,\n    balance\n  } = useAuth();\n  const [price, setPrice] = useState();\n  const {\n    onClose,\n    selectedItem,\n    open\n  } = props;\n\n  const handleClose = () => {\n    onClose(selectedItem);\n  };\n\n  async function sendPrice() {\n    const response = await fetch(\"/sendPrice\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        'user_key': currentBCAccount.privateKey,\n        'pubkeyOfRequest': selectedItem.pubkey,\n        'price': price,\n        'id': selectedItem.id\n      })\n    });\n    console.log(selectedItem);\n    let result;\n    let newPosts = [];\n    await response.json().then(message => {// result = message[\"data\"]\n    });\n    handleClose();\n  }\n\n  ;\n  return /*#__PURE__*/_jsxDEV(Dialog, {\n    \"aria-labelledby\": \"alert-dialog-title\",\n    fullWidth: true,\n    maxWidth: \"xs\",\n    onClose: handleClose,\n    open: open,\n    children: [/*#__PURE__*/_jsxDEV(DialogTitle, {\n      style: {\n        backgroundColor: 'navy',\n        color: 'white'\n      },\n      id: \"alert-dialog-title\",\n      children: \"Offer a price\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 398,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(DialogContent, {\n      children: [/*#__PURE__*/_jsxDEV(DialogContentText, {\n        children: /*#__PURE__*/_jsxDEV(Typography, {\n          fullWidth: true,\n          margin: \"dense\",\n          style: {\n            alignSelf: 'flex-start'\n          },\n          variant: \"subtitle1\",\n          children: selectedItem.description\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 403,\n          columnNumber: 15\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 402,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(TextField, {\n        onChange: e => setPrice(e.target.value),\n        autoFocus: true,\n        margin: \"dense\",\n        id: \"name\",\n        label: \"Price\",\n        type: \"number\",\n        fullWidth: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 405,\n        columnNumber: 15\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 401,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(DialogActions, {\n      children: /*#__PURE__*/_jsxDEV(IconButton, {\n        color: \"primary\",\n        component: \"span\",\n        onClick: sendPrice,\n        children: /*#__PURE__*/_jsxDEV(SendIcon, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 414,\n          columnNumber: 17\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 413,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 412,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 397,\n    columnNumber: 5\n  }, this);\n}\n\n_s2(SimpleDialog, \"rUyO3z+gWjwowiubThoYEfCDzwo=\", false, function () {\n  return [useStyles, useAuth];\n});\n\n_c2 = SimpleDialog;\nSimpleDialog.propTypes = {\n  onClose: PropTypes.func.isRequired,\n  open: PropTypes.bool.isRequired,\n  selectedItem: PropTypes.shape({\n    id: PropTypes.number,\n    description: PropTypes.string.isRequired,\n    pubkey: PropTypes.string.isRequired\n  })\n};\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"Posts\");\n$RefreshReg$(_c2, \"SimpleDialog\");","map":{"version":3,"sources":["/Users/kzjouf/Desktop/project/scdapp/src/pages/Posts.js"],"names":["xtype","AddPost","DialogTitle","DialogActions","DialogContent","DialogContentText","Dialog","Typography","Button","TextField","Grid","IconButton","DataGrid","XContract","text","ethers","useState","useEffect","makeStyles","green","SendIcon","VisibilityIcon","DealDialog","NewPostDialog","PropTypes","useAuth","useHistory","contractAddress","Posts","props","currentBCAccount","keypair","loading","balance","postList","setPostList","yourPostList","setYourPostList","open","setOpen","openOffer","setOpenOffer","openNewPost","setOpenNewPost","selectedItem","setSelectedItem","id","description","pubkey","state","deal","setDeal","minOffer","setMinOffer","classes","useStyles","history","State","columns","field","headerName","width","headerClassName","flex","renderCell","params","handleClickOpen","disableClickEventBubbling","columns2","sortDescendingFirst","color","loadMinOffer","row","handlePay","margin","handleCancel","setTimeout","listenEvents","handleClickLoad","push","item","response","fetch","method","headers","body","JSON","stringify","privateKey","x","result","newPosts","json","then","message","reload","handleCloseOffer","value","console","log","handleClose","handlePost","handleCloseNewPost","loadTasks","map","task","loadYourTasks","newYourPosts","newdeal","raw_price","height","marginLeft","marginRight","root","display","alignItems","justifyContent","marginTop","backgroundColor","fontFamily","fontWeight","SimpleDialog","price","setPrice","onClose","sendPrice","alignSelf","e","target","propTypes","func","isRequired","bool","shape","number","string"],"mappings":"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","sourcesContent":["import xtype from 'xtypejs'\nimport AddPost from '../components/AddPost';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport DialogActions from \"@material-ui/core/DialogActions\";\nimport DialogContent from \"@material-ui/core/DialogContent\";\nimport DialogContentText from \"@material-ui/core/DialogContentText\";\nimport Dialog from '@material-ui/core/Dialog';\nimport {Typography, Button, TextField, Grid} from '@material-ui/core'\nimport IconButton from '@material-ui/core/IconButton';\nimport { DataGrid } from '@material-ui/data-grid';\nimport XContract from './../artifacts/contracts/XContract.sol/XContract.json'\nimport text  from './../contract_address.json';\nimport {ethers} from 'ethers'\nimport {useState, useEffect} from 'react'\nimport { makeStyles } from '@material-ui/styles';\nimport { green } from '@material-ui/core/colors';\nimport SendIcon from '@material-ui/icons/Send';\nimport VisibilityIcon from '@material-ui/icons/Visibility';\nimport DealDialog from './components/Deal';\nimport NewPostDialog from './components/NewPost';\nimport PropTypes from 'prop-types';\nimport { useAuth } from \"../helper/AuthContext\"\nimport {useHistory} from 'react-router-dom';\n\nconst contractAddress = text['contract_address']\n\nfunction Posts (props) {\n    const { currentBCAccount, keypair, loading, balance} = useAuth()\n    const [postList, setPostList] = useState([])\n    const [yourPostList, setYourPostList] = useState([])\n    const [open, setOpen] = useState(false);\n    const [openOffer, setOpenOffer] = useState(false);\n    const [openNewPost, setOpenNewPost] = useState(false);\n    const [selectedItem, setSelectedItem] = useState({id:'', description: '', pubkey:'', state:''});\n    const [deal, setDeal] = useState();\n    const [minOffer, setMinOffer] = useState();\n    const classes = useStyles();\n    let history = useHistory()\n    const State = ['Processing', 'Assigned', 'WaitingPayValidation', 'Closed', 'Cancel'] ;\n    const columns = [\n      { field: 'id', headerName: 'ID', width: 68, headerClassName: 'super-app-theme--header'},\n      {\n        field: 'description',\n        headerName: 'Description',\n        headerClassName: 'super-app-theme--header',\n        flex: 1\n      },\n      // {\n      //     field: 'id',\n      //     headerName: 'id',\n      //     type: 'number',\n      //     width: 50,\n      //     editable: true,\n      //   }\n      {\n        field: 'action',\n        headerName: 'Action', headerClassName: 'super-app-theme--header',\n        width: 150,\n        renderCell: (params) => (\n          <strong>\n\n            <Button\n              variant=\"outlined\" color=\"secondary\"\n              size=\"small\"\n              onClick={() => handleClickOpen(params)}>\n              Offer a price\n            </Button>\n          </strong>\n        ),\n        disableClickEventBubbling: true,\n      }\n    ];\n\n    const columns2 = [\n      { field: 'id', headerName: 'ID', width: 68, headerClassName: 'super-app-theme--Filled', sortDescendingFirst : true},\n      {\n        field: 'description',\n        headerName: 'Description',\n        headerClassName: 'super-app-theme--Filled',\n        flex: 1\n      },\n      {\n        field: 'state',\n        headerName: 'State',\n        headerClassName: 'super-app-theme--Filled',\n        flex: 1\n      },\n      {\n        field: 'minprice',\n        headerName: 'Min Price',\n        headerClassName: 'super-app-theme--Filled',\n        width: 150,\n        renderCell: (params) => (\n          <strong>\n            <IconButton\n              style={{ color: green[500] }}\n              size=\"small\"\n              onClick={() => loadMinOffer(params.row)}>\n\n              <VisibilityIcon/>\n            </IconButton>\n          </strong>\n        ),\n        disableClickEventBubbling: true,\n      },\n      {\n        field: 'action',\n        headerName: 'Action', headerClassName: 'super-app-theme--Filled',\n        width: 150,\n        renderCell: (params) => (\n          <strong>\n\n            <Button\n              variant=\"contained\"\n              color=\"primary\"\n              size=\"small\"\n              alignItem='center'\n              disabled = {(params.row.state == 'Assigned'  || params.row.state == 'WaitingPayValidation')? false : true}\n              onClick={() => handlePay(params)}>\n              Pay\n            </Button>\n            <Button\n              variant=\"contained\"\n              color=\"primary\"\n              size=\"small\"\n              alignItem='center'\n              style={{margin : '10px'}}\n              disabled = {(params.row.state == 'Processing' || params.row.state ==  'Assigned')? false : true}\n              onClick={() => handleCancel(params.row)}>\n              Cancel\n            </Button>\n          </strong>\n        ),\n        disableClickEventBubbling: true,\n      }\n    ];\n\n    setTimeout(()=>{\n      listenEvents()\n    }, 5000);\n    \n    const handleClickLoad = (params) => {\n\n      setSelectedItem(params.row)\n      \n      \n    };\n\n    const handlePay = () => {\n\n      history.push(\"/\")\n    \n    };\n\n    async function handleCancel(item){\n      \n      setSelectedItem(item)\n      const response = await fetch(\"/cancelRequest\", {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({\n            'user_key': currentBCAccount.privateKey,\n            'id': item.id,\n            'x': keypair.x\n          }),\n        })\n        \n        let result\n        let newPosts = []\n        await response.json().then((message) => {\n          reload()\n        });\n   \n      // history.push(\"/\")\n    \n    };\n\n\n    const handleCloseOffer = (value) => {\n      setOpenOffer(false);\n      setSelectedItem(value);\n      \n    };\n    const handleClickOpen = (params) => {\n      console.log(params.row);\n      setSelectedItem(params.row)\n      setOpen(true);\n    };\n  \n    const handleClose = (value) => {\n      setOpen(false);\n      setSelectedItem(value);\n      reload();\n    };\n\n    const handlePost = () => {\n      setOpenNewPost(true);\n    };\n    const handleCloseNewPost = () => {\n      setOpenNewPost(false);\n      \n      reload();\n    };\n\n    async function loadTasks(){\n      console.log(\"key \", currentBCAccount.privateKey)\n      const response = await fetch(\"/loadTasks\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          'user_key': currentBCAccount.privateKey\n        })\n      })\n      let result\n      let newPosts = []\n      await response.json().then((message) => {\n        result = message[\"data\"]\n        result.map((task) => {\n          newPosts.push({id : task[0],\n            description : task[1],\n            pubkey: task[2]\n          })\n        })\n        setPostList(newPosts)\n  \n      });\n      // await listenEvents()\n      return result      \n    }\n\n    async function loadYourTasks(){\n      const response = await fetch(\"/loadYourTasks\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          'user_key': currentBCAccount.privateKey\n        })\n      })\n      let result\n      let newYourPosts = []\n      await response.json().then((message) => {\n        result = message[\"data\"]\n        result.map((task) => {\n          newYourPosts.push({id : task[0],\n            description : task[1],\n            pubkey: task[2],\n            state: State[task[3]]\n          })\n        })\n        setYourPostList(newYourPosts)\n\n      });\n      // await listenEvents()\n      return result      \n    }\n\n    async function loadMinOffer(item){\n      setSelectedItem(item)\n      const response = await fetch(\"/loadMinOffer\", {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({\n            'user_key': currentBCAccount.privateKey,\n            'id': item.id,\n            'x': keypair.x\n          }),\n        })\n        \n        let result\n        let newPosts = []\n        await response.json().then((message) => {\n          result = message[\"min_offer\"]\n          let newdeal = result['deal']\n          let raw_price = result['raw_price']\n          setDeal(newdeal)\n          setMinOffer(raw_price)\n          setOpenOffer(true);\n        });\n   \n  }\n\n\n    // async function listenEvents(){\n      \n    //   if (typeof window.ethereum !== 'undefined'){\n    //     const provider = new ethers.providers.Web3Provider(window.ethereum);\n    //     const contract = new ethers.Contract(contractAddress, XContract.abi, provider);\n    //     contract.on(\"NewPrice\", (id, CL_price, CR_price) => {\n    //       console.log(\"event \", id, CL_price, CR_price);\n    //     })\n    //     // console.log(contract.events)\n    //     // await contract.events.NewPrice({}).on(\"data\", (e) => console.log(e));\n    //   }\n    // }\n\n    useEffect(() => {\n      reload();\n      }, [])\n  \n    const reload = async () =>{\n      console.log(\"Closed..\")\n      await loadTasks();\n      await loadYourTasks();\n    }\n    \n    \n\n    \n    return (\n        <div style={{ height: '800px',  marginLeft: 100, marginRight: 20}} className={classes.root}>\n          <Grid container align-items=\"center\" style={{width: '100%',height: \"100%\" }}>\n              <Grid item xs style={{display: 'flex', alignItems: 'center', justifyContent: 'right'}}>\n                <Button size =\"small\" variant=\"outlined\" color=\"primary\" style={{margin: '10px' }} onClick={handlePost} > ADD POST </Button>\n                <Button size =\"small\" variant=\"outlined\" color=\"primary\" onClick={reload} > RELOAD </Button>\n              </Grid>\n              <Grid item xs={12} style={{height: \"42%\"}}>\n              <Typography variant=\"h5\" align=\"center\" component=\"h2\" style={{ color: \"#ab3402\" }}> ALL AVAILABLE TASKS </Typography>\n                <DataGrid\n                  rows={postList}\n                  columns={columns}\n                  pageSize={8}\n                //   checkboxSelection\n                  disableSelectionOnClick\n                />\n                <SimpleDialog selectedItem={selectedItem} open={open} onClose={handleClose}/>\n               \n              </Grid>\n              <Grid item xs={12} style={{height: \"42%\"}}>\n                <Typography variant=\"h6\" align=\"center\" component=\"h2\" color='textPrimary' style={{ marginTop: '10px'}} > YOUR POSTING </Typography>\n                <DataGrid\n\n                  rows={yourPostList}\n                  columns={columns2}\n                  pageSize={8}\n                //   checkboxSelection\n                  disableSelectionOnClick\n                />\n                <DealDialog selectedItem={selectedItem} open={openOffer} onClose={handleCloseOffer} deal={deal} price={minOffer}/>\n              </Grid>\n              \n          </Grid>\n          <NewPostDialog open={openNewPost} onClose={handleCloseNewPost}/>\n      </div>\n  \n    );\n    \n}\n\nconst useStyles = makeStyles({\n  root: {\n    '& .super-app-theme--header': {\n      backgroundColor: '#ab3402',\n      color:'white',\n    },\n    '& .super-app-theme--Filled': {\n      backgroundColor: '#094a14',\n      color:'white',\n      fontFamily: 'Vazir',\n      fontWeight: 'bold'\n    }\n  }\n});\nexport default (Posts);\n\nfunction SimpleDialog(props) {\n  const classes = useStyles();\n  const { currentBCAccount, keypair, loading, balance} = useAuth()\n  const [price, setPrice] = useState()\n  const { onClose, selectedItem, open} = props;\n\n  const handleClose = () => {\n    onClose(selectedItem);\n  };\n\n  async function sendPrice (){\n    const response = await fetch(\"/sendPrice\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({\n        'user_key': currentBCAccount.privateKey,\n        'pubkeyOfRequest': selectedItem.pubkey,\n        'price': price,\n        'id': selectedItem.id\n      }),\n    })\n    console.log(selectedItem)\n    let result\n    let newPosts = []\n    await response.json().then((message) => {\n      // result = message[\"data\"]\n      \n    });\n    handleClose()\n  };\n\n  return (\n    <Dialog aria-labelledby=\"alert-dialog-title\" fullWidth maxWidth='xs' onClose={handleClose} open={open}>\n        <DialogTitle  style={{ backgroundColor: 'navy', color: 'white' }} id=\"alert-dialog-title\">\n          Offer a price\n        </DialogTitle>\n        <DialogContent>\n            <DialogContentText>\n              <Typography fullWidth margin=\"dense\" style={{ alignSelf: 'flex-start'}} variant=\"subtitle1\">{selectedItem.description}</Typography>\n            </DialogContentText>\n              <TextField onChange={e => setPrice(e.target.value)} autoFocus\n                        margin=\"dense\"\n                        id=\"name\"\n                        label=\"Price\"\n                        type=\"number\"\n                        fullWidth          />\n        </DialogContent>\n        <DialogActions>\n          <IconButton color=\"primary\" component=\"span\" onClick={sendPrice}>\n                <SendIcon />\n          </IconButton>\n        </DialogActions>\n\n    </Dialog>\n  );\n}\n\nSimpleDialog.propTypes = {\n  onClose: PropTypes.func.isRequired,\n  open: PropTypes.bool.isRequired,\n  selectedItem: PropTypes.shape({\n    id: PropTypes.number,\n    description: PropTypes.string.isRequired,\n    pubkey: PropTypes.string.isRequired\n  })\n};\n\n\n\n"]},"metadata":{},"sourceType":"module"}